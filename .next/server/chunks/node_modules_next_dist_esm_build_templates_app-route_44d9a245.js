module.exports=[51604,e=>{"use strict";let t,s,r,n,i,a,o;var l,c,h,u,d,p,f,m,g,y,w,_,b,v,x,S,k,R,$,A,O,E,I,P,T,M,C,j,N,L,q,W,D,U,B,F,H,X,J,K,V,z,G,Q,Y,Z,ee,et,es,er,en,ei,ea,eo,el,ec,eh,eu,ed,ep,ef,em,eg,ey,ew,e_,eb,ev,ex,eS,ek,eR,e$,eA,eO,eE,eI,eP,eT,eM,eC,ej,eN,eL,eq,eW,eD,eU,eB,eF,eH,eX,eJ,eK,eV,ez,eG,eQ,eY,eZ,e0,e1,e2,e4,e5,e6,e3,e8,e9,e7,te,tt,ts,tr,tn,ti,ta,to,tl,tc,th,tu,td,tp,tf,tm,tg,ty,tw,t_,tb,tv,tx,tS,tk,tR,t$,tA,tO,tE,tI,tP,tT=e.i(47909),tM=e.i(74017),tC=e.i(96250),tj=e.i(59756),tN=e.i(61916),tL=e.i(74677),tq=e.i(69741),tW=e.i(16795),tD=e.i(87718),tU=e.i(95169),tB=e.i(47587),tF=e.i(66012),tH=e.i(70101),tX=e.i(74838),tJ=e.i(10372),tK=e.i(93695);e.i(52474);var tV=e.i(5232),tz=e.i(89171),tG=e.i(24389);function tQ(e,t,s,r,n){if("m"===r)throw TypeError("Private method is not writable");if("a"===r&&!n)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?n.call(e,s):n?n.value=s:t.set(e,s),s}function tY(e,t,s,r){if("a"===s&&!r)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?r:"a"===s?r.call(e):r?r.value:t.get(e)}let tZ=function(){let{crypto:e}=globalThis;if(e?.randomUUID)return tZ=e.randomUUID.bind(e),e.randomUUID();let t=new Uint8Array(1),s=e?()=>e.getRandomValues(t)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(e^s()&15>>e/4).toString(16))};function t0(e){return"object"==typeof e&&null!==e&&("name"in e&&"AbortError"===e.name||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}let t1=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e){try{if("[object Error]"===Object.prototype.toString.call(e)){let t=Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return Error(JSON.stringify(e))}catch{}}return Error(e)};class t2 extends Error{}class t4 extends t2{constructor(e,t,s,r){super(`${t4.makeMessage(e,t,s)}`),this.status=e,this.headers=r,this.requestID=r?.get("x-request-id"),this.error=t,this.code=t?.code,this.param=t?.param,this.type=t?.type}static makeMessage(e,t,s){let r=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):s;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||"(no status code or body)"}static generate(e,t,s,r){if(!e||!r)return new t6({message:s,cause:t1(t)});let n=t?.error;return 400===e?new t8(e,n,s,r):401===e?new t9(e,n,s,r):403===e?new t7(e,n,s,r):404===e?new se(e,n,s,r):409===e?new st(e,n,s,r):422===e?new ss(e,n,s,r):429===e?new sr(e,n,s,r):e>=500?new sn(e,n,s,r):new t4(e,n,s,r)}}class t5 extends t4{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class t6 extends t4{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class t3 extends t6{constructor({message:e}={}){super({message:e??"Request timed out."})}}class t8 extends t4{}class t9 extends t4{}class t7 extends t4{}class se extends t4{}class st extends t4{}class ss extends t4{}class sr extends t4{}class sn extends t4{}class si extends t2{constructor(){super("Could not parse response content as the length limit was reached")}}class sa extends t2{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class so extends Error{constructor(e){super(e)}}let sl=/^[a-z][a-z0-9+.-]*:/i,sc=e=>(sc=Array.isArray)(e),sh=sc;function su(e){return"object"!=typeof e?{}:e??{}}function sd(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}let sp=e=>new Promise(t=>setTimeout(t,e)),sf="6.15.0",sm=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",sg=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown";function sy(...e){let t=globalThis.ReadableStream;if(void 0===t)throw Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function sw(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return sy({start(){},async pull(e){let{done:s,value:r}=await t.next();s?e.close():e.enqueue(r)},async cancel(){await t.return?.()}})}function s_(e){if(e[Symbol.asyncIterator])return e;let t=e.getReader();return{async next(){try{let e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){let e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function sb(e){if(null===e||"object"!=typeof e)return;if(e[Symbol.asyncIterator])return void await e[Symbol.asyncIterator]().return?.();let t=e.getReader(),s=t.cancel();t.releaseLock(),await s}let sv=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)}),sx="RFC3986",sS=e=>String(e),sk={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:sS},sR=(e,t)=>(sR=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty))(e,t),s$=(()=>{let e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})();function sA(e,t){if(sc(e)){let s=[];for(let r=0;r<e.length;r+=1)s.push(t(e[r]));return s}return t(e)}let sO={brackets:e=>String(e)+"[]",comma:"comma",indices:(e,t)=>String(e)+"["+t+"]",repeat:e=>String(e)},sE=function(e,t){Array.prototype.push.apply(e,sc(t)?t:[t])},sI={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(e,t,s,r,n)=>{if(0===e.length)return e;let i=e;if("symbol"==typeof e?i=Symbol.prototype.toString.call(e):"string"!=typeof e&&(i=String(e)),"iso-8859-1"===s)return escape(i).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});let a="";for(let e=0;e<i.length;e+=1024){let t=i.length>=1024?i.slice(e,e+1024):i,s=[];for(let e=0;e<t.length;++e){let r=t.charCodeAt(e);if(45===r||46===r||95===r||126===r||r>=48&&r<=57||r>=65&&r<=90||r>=97&&r<=122||"RFC1738"===n&&(40===r||41===r)){s[s.length]=t.charAt(e);continue}if(r<128){s[s.length]=s$[r];continue}if(r<2048){s[s.length]=s$[192|r>>6]+s$[128|63&r];continue}if(r<55296||r>=57344){s[s.length]=s$[224|r>>12]+s$[128|r>>6&63]+s$[128|63&r];continue}e+=1,r=65536+((1023&r)<<10|1023&t.charCodeAt(e)),s[s.length]=s$[240|r>>18]+s$[128|r>>12&63]+s$[128|r>>6&63]+s$[128|63&r]}a+=s.join("")}return a},encodeValuesOnly:!1,format:sx,formatter:sS,indices:!1,serializeDate:e=>(s??(s=Function.prototype.call.bind(Date.prototype.toISOString)))(e),skipNulls:!1,strictNullHandling:!1},sP={};function sT(e){let t;return(r??(r=(t=new globalThis.TextEncoder).encode.bind(t)))(e)}function sM(e){let t;return(n??(n=(t=new globalThis.TextDecoder).decode.bind(t)))(e)}class sC{constructor(){l.set(this,void 0),c.set(this,void 0),tQ(this,l,new Uint8Array,"f"),tQ(this,c,null,"f")}decode(e){let t;if(null==e)return[];let s=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?sT(e):e;tQ(this,l,function(e){let t=0;for(let s of e)t+=s.length;let s=new Uint8Array(t),r=0;for(let t of e)s.set(t,r),r+=t.length;return s}([tY(this,l,"f"),s]),"f");let r=[];for(;null!=(t=function(e,t){for(let s=t??0;s<e.length;s++){if(10===e[s])return{preceding:s,index:s+1,carriage:!1};if(13===e[s])return{preceding:s,index:s+1,carriage:!0}}return null}(tY(this,l,"f"),tY(this,c,"f")));){if(t.carriage&&null==tY(this,c,"f")){tQ(this,c,t.index,"f");continue}if(null!=tY(this,c,"f")&&(t.index!==tY(this,c,"f")+1||t.carriage)){r.push(sM(tY(this,l,"f").subarray(0,tY(this,c,"f")-1))),tQ(this,l,tY(this,l,"f").subarray(tY(this,c,"f")),"f"),tQ(this,c,null,"f");continue}let e=null!==tY(this,c,"f")?t.preceding-1:t.preceding,s=sM(tY(this,l,"f").subarray(0,e));r.push(s),tQ(this,l,tY(this,l,"f").subarray(t.index),"f"),tQ(this,c,null,"f")}return r}flush(){return tY(this,l,"f").length?this.decode("\n"):[]}}l=new WeakMap,c=new WeakMap,sC.NEWLINE_CHARS=new Set(["\n","\r"]),sC.NEWLINE_REGEXP=/\r\n|[\n\r]/g;let sj={off:0,error:200,warn:300,info:400,debug:500},sN=(e,t,s)=>{if(e){if(Object.prototype.hasOwnProperty.call(sj,e))return e;sU(s).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(sj))}`)}};function sL(){}function sq(e,t,s){return!t||sj[e]>sj[s]?sL:t[e].bind(t)}let sW={error:sL,warn:sL,info:sL,debug:sL},sD=new WeakMap;function sU(e){let t=e.logger,s=e.logLevel??"off";if(!t)return sW;let r=sD.get(t);if(r&&r[0]===s)return r[1];let n={error:sq("error",t,s),warn:sq("warn",t,s),info:sq("info",t,s),debug:sq("debug",t,s)};return sD.set(t,[s,n]),n}let sB=e=>(e.options&&(e.options={...e.options},delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([e,t])=>[e,"authorization"===e.toLowerCase()||"cookie"===e.toLowerCase()||"set-cookie"===e.toLowerCase()?"***":t]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);class sF{constructor(e,t,s){this.iterator=e,h.set(this,void 0),this.controller=t,tQ(this,h,s,"f")}static fromSSEResponse(e,t,s){let r=!1,n=s?sU(s):console;async function*i(){if(r)throw new t2("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let s=!1;try{for await(let r of sH(e,t))if(!s){if(r.data.startsWith("[DONE]")){s=!0;continue}if(null!==r.event&&r.event.startsWith("thread.")){let e;try{e=JSON.parse(r.data)}catch(e){throw console.error("Could not parse message into JSON:",r.data),console.error("From chunk:",r.raw),e}if("error"==r.event)throw new t4(void 0,e.error,e.message,void 0);yield{event:r.event,data:e}}else{let t;try{t=JSON.parse(r.data)}catch(e){throw n.error("Could not parse message into JSON:",r.data),n.error("From chunk:",r.raw),e}if(t&&t.error)throw new t4(void 0,t.error,void 0,e.headers);yield t}}s=!0}catch(e){if(t0(e))return;throw e}finally{s||t.abort()}}return new sF(i,t,s)}static fromReadableStream(e,t,s){let r=!1;async function*n(){let t=new sC;for await(let s of s_(e))for(let e of t.decode(s))yield e;for(let e of t.flush())yield e}return new sF(async function*(){if(r)throw new t2("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let e=!1;try{for await(let t of n())!e&&t&&(yield JSON.parse(t));e=!0}catch(e){if(t0(e))return;throw e}finally{e||t.abort()}},t,s)}[(h=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){let e=[],t=[],s=this.iterator(),r=r=>({next:()=>{if(0===r.length){let r=s.next();e.push(r),t.push(r)}return r.shift()}});return[new sF(()=>r(e),this.controller,tY(this,h,"f")),new sF(()=>r(t),this.controller,tY(this,h,"f"))]}toReadableStream(){let e,t=this;return sy({async start(){e=t[Symbol.asyncIterator]()},async pull(t){try{let{value:s,done:r}=await e.next();if(r)return t.close();let n=sT(JSON.stringify(s)+"\n");t.enqueue(n)}catch(e){t.error(e)}},async cancel(){await e.return?.()}})}}async function*sH(e,t){if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new t2("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new t2("Attempted to iterate over a response with no body")}let s=new sJ,r=new sC;for await(let t of sX(s_(e.body)))for(let e of r.decode(t)){let t=s.decode(e);t&&(yield t)}for(let e of r.flush()){let t=s.decode(e);t&&(yield t)}}async function*sX(e){let t=new Uint8Array;for await(let s of e){let e;if(null==s)continue;let r=s instanceof ArrayBuffer?new Uint8Array(s):"string"==typeof s?sT(s):s,n=new Uint8Array(t.length+r.length);for(n.set(t),n.set(r,t.length),t=n;-1!==(e=function(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1]||13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return -1}(t));)yield t.slice(0,e),t=t.slice(e)}t.length>0&&(yield t)}class sJ{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){var t;let s;if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[r,n,i]=-1!==(s=(t=e).indexOf(":"))?[t.substring(0,s),":",t.substring(s+1)]:[t,"",""];return i.startsWith(" ")&&(i=i.substring(1)),"event"===r?this.event=i:"data"===r&&this.data.push(i),null}}async function sK(e,t){let{response:s,requestLogID:r,retryOfRequestLogID:n,startTime:i}=t,a=await (async()=>{if(t.options.stream)return(sU(e).debug("response",s.status,s.url,s.headers,s.body),t.options.__streamClass)?t.options.__streamClass.fromSSEResponse(s,t.controller,e):sF.fromSSEResponse(s,t.controller,e);if(204===s.status)return null;if(t.options.__binaryResponse)return s;let r=s.headers.get("content-type"),n=r?.split(";")[0]?.trim();return n?.includes("application/json")||n?.endsWith("+json")?sV(await s.json(),s):await s.text()})();return sU(e).debug(`[${r}] response parsed`,sB({retryOfRequestLogID:n,url:s.url,status:s.status,body:a,durationMs:Date.now()-i})),a}function sV(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}class sz extends Promise{constructor(e,t,s=sK){super(e=>{e(null)}),this.responsePromise=t,this.parseResponse=s,u.set(this,void 0),tQ(this,u,e,"f")}_thenUnwrap(e){return new sz(tY(this,u,"f"),this.responsePromise,async(t,s)=>sV(e(await this.parseResponse(t,s),s),s.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(tY(this,u,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}u=new WeakMap;class sG{constructor(e,t,s,r){d.set(this,void 0),tQ(this,d,e,"f"),this.options=r,this.response=t,this.body=s}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageRequestOptions()}async getNextPage(){let e=this.nextPageRequestOptions();if(!e)throw new t2("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await tY(this,d,"f").requestAPIList(this.constructor,e)}async *iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async *[(d=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}}class sQ extends sz{constructor(e,t,s){super(e,t,async(e,t)=>new s(e,t.response,await sK(e,t),t.options))}async *[Symbol.asyncIterator](){for await(let e of(await this))yield e}}class sY extends sG{constructor(e,t,s,r){super(e,t,s,r),this.data=s.data||[],this.object=s.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}}class sZ extends sG{constructor(e,t,s,r){super(e,t,s,r),this.data=s.data||[],this.has_more=s.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){let e=this.getPaginatedItems(),t=e[e.length-1]?.id;return t?{...this.options,query:{...su(this.options.query),after:t}}:null}}class s0 extends sG{constructor(e,t,s,r){super(e,t,s,r),this.data=s.data||[],this.has_more=s.has_more||!1,this.last_id=s.last_id||""}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){let e=this.last_id;return e?{...this.options,query:{...su(this.options.query),after:e}}:null}}let s1=()=>{if("undefined"==typeof File){let{process:e}=globalThis;throw Error("`File` is not defined as a global, which is required for file uploads."+("string"==typeof e?.versions?.node&&20>parseInt(e.versions.node.split("."))?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function s2(e,t,s){return s1(),new File(e,t??"unknown_file",s)}function s4(e){return("object"==typeof e&&null!==e&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}let s5=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],s6=async(e,t)=>re(e.body)?{...e,body:await s9(e.body,t)}:e,s3=async(e,t)=>({...e,body:await s9(e.body,t)}),s8=new WeakMap,s9=async(e,t)=>{if(!await function(e){let t="function"==typeof e?e:e.fetch,s=s8.get(t);if(s)return s;let r=(async()=>{try{let e="Response"in t?t.Response:(await t("data:,")).constructor,s=new FormData;if(s.toString()===await new e(s).text())return!1;return!0}catch{return!0}})();return s8.set(t,r),r}(t))throw TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let s=new FormData;return await Promise.all(Object.entries(e||{}).map(([e,t])=>rt(s,e,t))),s},s7=e=>e instanceof Blob&&"name"in e,re=e=>{if("object"==typeof e&&null!==e&&(e instanceof Response||s5(e)||s7(e)))return!0;if(Array.isArray(e))return e.some(re);if(e&&"object"==typeof e){for(let t in e)if(re(e[t]))return!0}return!1},rt=async(e,t,s)=>{if(void 0!==s){if(null==s)throw TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof s||"number"==typeof s||"boolean"==typeof s)e.append(t,String(s));else if(s instanceof Response)e.append(t,s2([await s.blob()],s4(s)));else if(s5(s))e.append(t,s2([await new Response(sw(s)).blob()],s4(s)));else if(s7(s))e.append(t,s,s4(s));else if(Array.isArray(s))await Promise.all(s.map(s=>rt(e,t+"[]",s)));else if("object"==typeof s)await Promise.all(Object.entries(s).map(([s,r])=>rt(e,`${t}[${s}]`,r)));else throw TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${s} instead`)}},rs=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer;async function rr(e,t,s){let r,n;if(s1(),null!=(r=e=await e)&&"object"==typeof r&&"string"==typeof r.name&&"number"==typeof r.lastModified&&rs(r))return e instanceof File?e:s2([await e.arrayBuffer()],e.name);if(null!=(n=e)&&"object"==typeof n&&"string"==typeof n.url&&"function"==typeof n.blob){let r=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),s2(await rn(r),t,s)}let i=await rn(e);if(t||(t=s4(e)),!s?.type){let e=i.find(e=>"object"==typeof e&&"type"in e&&e.type);"string"==typeof e&&(s={...s,type:e})}return s2(i,t,s)}async function rn(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(rs(e))t.push(e instanceof Blob?e:await e.arrayBuffer());else if(s5(e))for await(let s of e)t.push(...await rn(s));else{let t=e?.constructor?.name;throw Error(`Unexpected data type: ${typeof e}${t?`; constructor: ${t}`:""}${function(e){if("object"!=typeof e||null===e)return"";let t=Object.getOwnPropertyNames(e);return`; props: [${t.map(e=>`"${e}"`).join(", ")}]`}(e)}`)}return t}class ri{constructor(e){this._client=e}}function ra(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}let ro=Object.freeze(Object.create(null)),rl=((e=ra)=>function(t,...s){let r;if(1===t.length)return t[0];let n=!1,i=[],a=t.reduce((t,r,a)=>{/[?#]/.test(r)&&(n=!0);let o=s[a],l=(n?encodeURIComponent:e)(""+o);return a!==s.length&&(null==o||"object"==typeof o&&o.toString===Object.getPrototypeOf(Object.getPrototypeOf(o.hasOwnProperty??ro)??ro)?.toString)&&(l=o+"",i.push({start:t.length+r.length,length:l.length,error:`Value of type ${Object.prototype.toString.call(o).slice(8,-1)} is not a valid path parameter`})),t+r+(a===s.length?"":l)},""),o=a.split(/[?#]/,1)[0],l=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;for(;null!==(r=l.exec(o));)i.push({start:r.index,length:r[0].length,error:`Value "${r[0]}" can't be safely passed as a path parameter`});if(i.sort((e,t)=>e.start-t.start),i.length>0){let e=0,t=i.reduce((t,s)=>{let r=" ".repeat(s.start-e),n="^".repeat(s.length);return e=s.start+s.length,t+r+n},"");throw new t2(`Path parameters result in path with invalid segments:
${i.map(e=>e.error).join("\n")}
${a}
${t}`)}return a})(ra);class rc extends ri{list(e,t={},s){return this._client.getAPIList(rl`/chat/completions/${e}/messages`,sZ,{query:t,...s})}}function rh(e){return void 0!==e&&"function"in e&&void 0!==e.function}function ru(e){return e?.$brand==="auto-parseable-response-format"}function rd(e){return e?.$brand==="auto-parseable-tool"}function rp(e,t){let s=e.choices.map(e=>{var s,r;if("length"===e.finish_reason)throw new si;if("content_filter"===e.finish_reason)throw new sa;return rm(e.message.tool_calls),{...e,message:{...e.message,...e.message.tool_calls?{tool_calls:e.message.tool_calls?.map(e=>{var s,r;let n;return s=t,r=e,n=s.tools?.find(e=>rh(e)&&e.function?.name===r.function.name),{...r,function:{...r.function,parsed_arguments:rd(n)?n.$parseRaw(r.function.arguments):n?.function.strict?JSON.parse(r.function.arguments):null}}})??void 0}:void 0,parsed:e.message.content&&!e.message.refusal?(s=t,r=e.message.content,s.response_format?.type!=="json_schema"?null:s.response_format?.type==="json_schema"?"$parseRaw"in s.response_format?s.response_format.$parseRaw(r):JSON.parse(r):null):null}}});return{...e,choices:s}}function rf(e){return!!ru(e.response_format)||(e.tools?.some(e=>rd(e)||"function"===e.type&&!0===e.function.strict)??!1)}function rm(e){for(let t of e||[])if("function"!==t.type)throw new t2(`Currently only \`function\` tool calls are supported; Received \`${t.type}\``)}let rg=e=>e?.role==="assistant",ry=e=>e?.role==="tool";class rw{constructor(){p.add(this),this.controller=new AbortController,f.set(this,void 0),m.set(this,()=>{}),g.set(this,()=>{}),y.set(this,void 0),w.set(this,()=>{}),_.set(this,()=>{}),b.set(this,{}),v.set(this,!1),x.set(this,!1),S.set(this,!1),k.set(this,!1),tQ(this,f,new Promise((e,t)=>{tQ(this,m,e,"f"),tQ(this,g,t,"f")}),"f"),tQ(this,y,new Promise((e,t)=>{tQ(this,w,e,"f"),tQ(this,_,t,"f")}),"f"),tY(this,f,"f").catch(()=>{}),tY(this,y,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},tY(this,p,"m",R).bind(this))},0)}_connected(){this.ended||(tY(this,m,"f").call(this),this._emit("connect"))}get ended(){return tY(this,v,"f")}get errored(){return tY(this,x,"f")}get aborted(){return tY(this,S,"f")}abort(){this.controller.abort()}on(e,t){return(tY(this,b,"f")[e]||(tY(this,b,"f")[e]=[])).push({listener:t}),this}off(e,t){let s=tY(this,b,"f")[e];if(!s)return this;let r=s.findIndex(e=>e.listener===t);return r>=0&&s.splice(r,1),this}once(e,t){return(tY(this,b,"f")[e]||(tY(this,b,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,s)=>{tQ(this,k,!0,"f"),"error"!==e&&this.once("error",s),this.once(e,t)})}async done(){tQ(this,k,!0,"f"),await tY(this,y,"f")}_emit(e,...t){if(tY(this,v,"f"))return;"end"===e&&(tQ(this,v,!0,"f"),tY(this,w,"f").call(this));let s=tY(this,b,"f")[e];if(s&&(tY(this,b,"f")[e]=s.filter(e=>!e.once),s.forEach(({listener:e})=>e(...t))),"abort"===e){let e=t[0];tY(this,k,"f")||s?.length||Promise.reject(e),tY(this,g,"f").call(this,e),tY(this,_,"f").call(this,e),this._emit("end");return}if("error"===e){let e=t[0];tY(this,k,"f")||s?.length||Promise.reject(e),tY(this,g,"f").call(this,e),tY(this,_,"f").call(this,e),this._emit("end")}}_emitFinal(){}}f=new WeakMap,m=new WeakMap,g=new WeakMap,y=new WeakMap,w=new WeakMap,_=new WeakMap,b=new WeakMap,v=new WeakMap,x=new WeakMap,S=new WeakMap,k=new WeakMap,p=new WeakSet,R=function(e){if(tQ(this,x,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new t5),e instanceof t5)return tQ(this,S,!0,"f"),this._emit("abort",e);if(e instanceof t2)return this._emit("error",e);if(e instanceof Error){let t=new t2(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new t2(String(e)))};class r_ extends rw{constructor(){super(...arguments),$.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);let t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),ry(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(rg(e)&&e.tool_calls)for(let t of e.tool_calls)"function"===t.type&&this._emit("functionToolCall",t.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new t2("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),tY(this,$,"m",A).call(this)}async finalMessage(){return await this.done(),tY(this,$,"m",O).call(this)}async finalFunctionToolCall(){return await this.done(),tY(this,$,"m",E).call(this)}async finalFunctionToolCallResult(){return await this.done(),tY(this,$,"m",I).call(this)}async totalUsage(){return await this.done(),tY(this,$,"m",P).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let t=tY(this,$,"m",O).call(this);t&&this._emit("finalMessage",t);let s=tY(this,$,"m",A).call(this);s&&this._emit("finalContent",s);let r=tY(this,$,"m",E).call(this);r&&this._emit("finalFunctionToolCall",r);let n=tY(this,$,"m",I).call(this);null!=n&&this._emit("finalFunctionToolCallResult",n),this._chatCompletions.some(e=>e.usage)&&this._emit("totalUsage",tY(this,$,"m",P).call(this))}async _createChatCompletion(e,t,s){let r=s?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),tY(this,$,"m",T).call(this,t);let n=await e.chat.completions.create({...t,stream:!1},{...s,signal:this.controller.signal});return this._connected(),this._addChatCompletion(rp(n,t))}async _runChatCompletion(e,t,s){for(let e of t.messages)this._addMessage(e,!1);return await this._createChatCompletion(e,t,s)}async _runTools(e,t,s){let r="tool",{tool_choice:n="auto",stream:i,...a}=t,o="string"!=typeof n&&"function"===n.type&&n?.function?.name,{maxChatCompletions:l=10}=s||{},c=t.tools.map(e=>{if(rd(e)){if(!e.$callback)throw new t2("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:e.$callback,name:e.function.name,description:e.function.description||"",parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e}),h={};for(let e of c)"function"===e.type&&(h[e.function.name||e.function.function.name]=e.function);let u="tools"in t?c.map(e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e):void 0;for(let e of t.messages)this._addMessage(e,!1);for(let t=0;t<l;++t){let t=await this._createChatCompletion(e,{...a,tool_choice:n,tools:u,messages:[...this.messages]},s),i=t.choices[0]?.message;if(!i)throw new t2("missing message in ChatCompletion response");if(!i.tool_calls?.length)break;for(let e of i.tool_calls){let t;if("function"!==e.type)continue;let s=e.id,{name:n,arguments:i}=e.function,a=h[n];if(a){if(o&&o!==n){let e=`Invalid tool_call: ${JSON.stringify(n)}. ${JSON.stringify(o)} requested. Please try again`;this._addMessage({role:r,tool_call_id:s,content:e});continue}}else{let e=`Invalid tool_call: ${JSON.stringify(n)}. Available options are: ${Object.keys(h).map(e=>JSON.stringify(e)).join(", ")}. Please try again`;this._addMessage({role:r,tool_call_id:s,content:e});continue}try{t="function"==typeof a.parse?await a.parse(i):i}catch(t){let e=t instanceof Error?t.message:String(t);this._addMessage({role:r,tool_call_id:s,content:e});continue}let l=await a.function(t,this),c=tY(this,$,"m",M).call(this,l);if(this._addMessage({role:r,tool_call_id:s,content:c}),o)return}}}}$=new WeakSet,A=function(){return tY(this,$,"m",O).call(this).content??null},O=function(){let e=this.messages.length;for(;e-- >0;){let t=this.messages[e];if(rg(t))return{...t,content:t.content??null,refusal:t.refusal??null}}throw new t2("stream ended without producing a ChatCompletionMessage with role=assistant")},E=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(rg(t)&&t?.tool_calls?.length)return t.tool_calls.filter(e=>"function"===e.type).at(-1)?.function}},I=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(ry(t)&&null!=t.content&&"string"==typeof t.content&&this.messages.some(e=>"assistant"===e.role&&e.tool_calls?.some(e=>"function"===e.type&&e.id===t.tool_call_id)))return t.content}},P=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},T=function(e){if(null!=e.n&&e.n>1)throw new t2("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},M=function(e){return"string"==typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class rb extends r_{static runTools(e,t,s){let r=new rb,n={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,t,n)),r}_addMessage(e,t=!0){super._addMessage(e,t),rg(e)&&e.content&&this._emit("content",e.content)}}let rv=511;class rx extends Error{}class rS extends Error{}let rk=e=>(function(e,t=rv){var s,r;let n,i,a,o,l,c,h,u,d,p;if("string"!=typeof e)throw TypeError(`expecting str, got ${typeof e}`);if(!e.trim())throw Error(`${e} is empty`);return s=e.trim(),r=t,n=s.length,i=0,a=e=>{throw new rx(`${e} at position ${i}`)},o=e=>{throw new rS(`${e} at position ${i}`)},l=()=>(p(),i>=n&&a("Unexpected end of input"),'"'===s[i])?c():"{"===s[i]?h():"["===s[i]?u():"null"===s.substring(i,i+4)||16&r&&n-i<4&&"null".startsWith(s.substring(i))?(i+=4,null):"true"===s.substring(i,i+4)||32&r&&n-i<4&&"true".startsWith(s.substring(i))?(i+=4,!0):"false"===s.substring(i,i+5)||32&r&&n-i<5&&"false".startsWith(s.substring(i))?(i+=5,!1):"Infinity"===s.substring(i,i+8)||128&r&&n-i<8&&"Infinity".startsWith(s.substring(i))?(i+=8,1/0):"-Infinity"===s.substring(i,i+9)||256&r&&1<n-i&&n-i<9&&"-Infinity".startsWith(s.substring(i))?(i+=9,-1/0):"NaN"===s.substring(i,i+3)||64&r&&n-i<3&&"NaN".startsWith(s.substring(i))?(i+=3,NaN):d(),c=()=>{let e=i,t=!1;for(i++;i<n&&('"'!==s[i]||t&&"\\"===s[i-1]);)t="\\"===s[i]&&!t,i++;if('"'==s.charAt(i))try{return JSON.parse(s.substring(e,++i-Number(t)))}catch(e){o(String(e))}else if(1&r)try{return JSON.parse(s.substring(e,i-Number(t))+'"')}catch(t){return JSON.parse(s.substring(e,s.lastIndexOf("\\"))+'"')}a("Unterminated string literal")},h=()=>{i++,p();let e={};try{for(;"}"!==s[i];){if(p(),i>=n&&8&r)return e;let t=c();p(),i++;try{let s=l();Object.defineProperty(e,t,{value:s,writable:!0,enumerable:!0,configurable:!0})}catch(t){if(8&r)return e;throw t}p(),","===s[i]&&i++}}catch(t){if(8&r)return e;a("Expected '}' at end of object")}return i++,e},u=()=>{i++;let e=[];try{for(;"]"!==s[i];)e.push(l()),p(),","===s[i]&&i++}catch(t){if(4&r)return e;a("Expected ']' at end of array")}return i++,e},d=()=>{if(0===i){"-"===s&&2&r&&a("Not sure what '-' is");try{return JSON.parse(s)}catch(e){if(2&r)try{if("."===s[s.length-1])return JSON.parse(s.substring(0,s.lastIndexOf(".")));return JSON.parse(s.substring(0,s.lastIndexOf("e")))}catch(e){}o(String(e))}}let e=i;for("-"===s[i]&&i++;s[i]&&!",]}".includes(s[i]);)i++;i!=n||2&r||a("Unterminated number literal");try{return JSON.parse(s.substring(e,i))}catch(t){"-"===s.substring(e,i)&&2&r&&a("Not sure what '-' is");try{return JSON.parse(s.substring(e,s.lastIndexOf("e")))}catch(e){o(String(e))}}},p=()=>{for(;i<n&&" \n\r	".includes(s[i]);)i++},l()})(e,2^rv);class rR extends r_{constructor(e){super(),C.add(this),j.set(this,void 0),N.set(this,void 0),L.set(this,void 0),tQ(this,j,e,"f"),tQ(this,N,[],"f")}get currentChatCompletionSnapshot(){return tY(this,L,"f")}static fromReadableStream(e){let t=new rR(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,s){let r=new rR(t);return r._run(()=>r._runChatCompletion(e,{...t,stream:!0},{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createChatCompletion(e,t,s){super._createChatCompletion;let r=s?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),tY(this,C,"m",q).call(this);let n=await e.chat.completions.create({...t,stream:!0},{...s,signal:this.controller.signal});for await(let e of(this._connected(),n))tY(this,C,"m",D).call(this,e);if(n.controller.signal?.aborted)throw new t5;return this._addChatCompletion(tY(this,C,"m",F).call(this))}async _fromReadableStream(e,t){let s,r=t?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),tY(this,C,"m",q).call(this),this._connected();let n=sF.fromReadableStream(e,this.controller);for await(let e of n)s&&s!==e.id&&this._addChatCompletion(tY(this,C,"m",F).call(this)),tY(this,C,"m",D).call(this,e),s=e.id;if(n.controller.signal?.aborted)throw new t5;return this._addChatCompletion(tY(this,C,"m",F).call(this))}[(j=new WeakMap,N=new WeakMap,L=new WeakMap,C=new WeakSet,q=function(){this.ended||tQ(this,L,void 0,"f")},W=function(e){let t=tY(this,N,"f")[e.index];return t||(t={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},tY(this,N,"f")[e.index]=t),t},D=function(e){if(this.ended)return;let t=tY(this,C,"m",X).call(this,e);for(let s of(this._emit("chunk",e,t),e.choices)){let e=t.choices[s.index];null!=s.delta.content&&e.message?.role==="assistant"&&e.message?.content&&(this._emit("content",s.delta.content,e.message.content),this._emit("content.delta",{delta:s.delta.content,snapshot:e.message.content,parsed:e.message.parsed})),null!=s.delta.refusal&&e.message?.role==="assistant"&&e.message?.refusal&&this._emit("refusal.delta",{delta:s.delta.refusal,snapshot:e.message.refusal}),s.logprobs?.content!=null&&e.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:s.logprobs?.content,snapshot:e.logprobs?.content??[]}),s.logprobs?.refusal!=null&&e.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:s.logprobs?.refusal,snapshot:e.logprobs?.refusal??[]});let r=tY(this,C,"m",W).call(this,e);for(let t of(e.finish_reason&&(tY(this,C,"m",B).call(this,e),null!=r.current_tool_call_index&&tY(this,C,"m",U).call(this,e,r.current_tool_call_index)),s.delta.tool_calls??[]))r.current_tool_call_index!==t.index&&(tY(this,C,"m",B).call(this,e),null!=r.current_tool_call_index&&tY(this,C,"m",U).call(this,e,r.current_tool_call_index)),r.current_tool_call_index=t.index;for(let t of s.delta.tool_calls??[]){let s=e.message.tool_calls?.[t.index];s?.type&&(s?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:s.function?.name,index:t.index,arguments:s.function.arguments,parsed_arguments:s.function.parsed_arguments,arguments_delta:t.function?.arguments??""}):rO(s?.type))}}},U=function(e,t){if(tY(this,C,"m",W).call(this,e).done_tool_calls.has(t))return;let s=e.message.tool_calls?.[t];if(!s)throw Error("no tool call snapshot");if(!s.type)throw Error("tool call snapshot missing `type`");if("function"===s.type){let e=tY(this,j,"f")?.tools?.find(e=>rh(e)&&e.function.name===s.function.name);this._emit("tool_calls.function.arguments.done",{name:s.function.name,index:t,arguments:s.function.arguments,parsed_arguments:rd(e)?e.$parseRaw(s.function.arguments):e?.function.strict?JSON.parse(s.function.arguments):null})}else rO(s.type)},B=function(e){let t=tY(this,C,"m",W).call(this,e);if(e.message.content&&!t.content_done){t.content_done=!0;let s=tY(this,C,"m",H).call(this);this._emit("content.done",{content:e.message.content,parsed:s?s.$parseRaw(e.message.content):null})}e.message.refusal&&!t.refusal_done&&(t.refusal_done=!0,this._emit("refusal.done",{refusal:e.message.refusal})),e.logprobs?.content&&!t.logprobs_content_done&&(t.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:e.logprobs.content})),e.logprobs?.refusal&&!t.logprobs_refusal_done&&(t.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal}))},F=function(){if(this.ended)throw new t2("stream has ended, this shouldn't happen");let e=tY(this,L,"f");if(!e)throw new t2("request ended without sending any chunks");return tQ(this,L,void 0,"f"),tQ(this,N,[],"f"),function(e,t){var s;let{id:r,choices:n,created:i,model:a,system_fingerprint:o,...l}=e;return s={...l,id:r,choices:n.map(({message:t,finish_reason:s,index:r,logprobs:n,...i})=>{if(!s)throw new t2(`missing finish_reason for choice ${r}`);let{content:a=null,function_call:o,tool_calls:l,...c}=t,h=t.role;if(!h)throw new t2(`missing role for choice ${r}`);if(o){let{arguments:e,name:l}=o;if(null==e)throw new t2(`missing function_call.arguments for choice ${r}`);if(!l)throw new t2(`missing function_call.name for choice ${r}`);return{...i,message:{content:a,function_call:{arguments:e,name:l},role:h,refusal:t.refusal??null},finish_reason:s,index:r,logprobs:n}}return l?{...i,index:r,finish_reason:s,logprobs:n,message:{...c,role:h,content:a,refusal:t.refusal??null,tool_calls:l.map((t,s)=>{let{function:n,type:i,id:a,...o}=t,{arguments:l,name:c,...h}=n||{};if(null==a)throw new t2(`missing choices[${r}].tool_calls[${s}].id
${r$(e)}`);if(null==i)throw new t2(`missing choices[${r}].tool_calls[${s}].type
${r$(e)}`);if(null==c)throw new t2(`missing choices[${r}].tool_calls[${s}].function.name
${r$(e)}`);if(null==l)throw new t2(`missing choices[${r}].tool_calls[${s}].function.arguments
${r$(e)}`);return{...o,id:a,type:i,function:{...h,name:c,arguments:l}}})}}:{...i,message:{...c,content:a,role:h,refusal:t.refusal??null},finish_reason:s,index:r,logprobs:n}}),created:i,model:a,object:"chat.completion",...o?{system_fingerprint:o}:{}},t&&rf(t)?rp(s,t):{...s,choices:s.choices.map(e=>(rm(e.message.tool_calls),{...e,message:{...e.message,parsed:null,...e.message.tool_calls?{tool_calls:e.message.tool_calls}:void 0}}))}}(e,tY(this,j,"f"))},H=function(){let e=tY(this,j,"f")?.response_format;return ru(e)?e:null},X=function(e){var t,s,r,n;let i=tY(this,L,"f"),{choices:a,...o}=e;for(let{delta:a,finish_reason:l,index:c,logprobs:h=null,...u}of(i?Object.assign(i,o):i=tQ(this,L,{...o,choices:[]},"f"),e.choices)){let e=i.choices[c];if(e||(e=i.choices[c]={finish_reason:l,index:c,message:{},logprobs:h,...u}),h)if(e.logprobs){let{content:r,refusal:n,...i}=h;rA(i),Object.assign(e.logprobs,i),r&&((t=e.logprobs).content??(t.content=[]),e.logprobs.content.push(...r)),n&&((s=e.logprobs).refusal??(s.refusal=[]),e.logprobs.refusal.push(...n))}else e.logprobs=Object.assign({},h);if(l&&(e.finish_reason=l,tY(this,j,"f")&&rf(tY(this,j,"f")))){if("length"===l)throw new si;if("content_filter"===l)throw new sa}if(Object.assign(e,u),!a)continue;let{content:o,refusal:d,function_call:p,role:f,tool_calls:m,...g}=a;if(rA(g),Object.assign(e.message,g),d&&(e.message.refusal=(e.message.refusal||"")+d),f&&(e.message.role=f),p&&(e.message.function_call?(p.name&&(e.message.function_call.name=p.name),p.arguments&&((r=e.message.function_call).arguments??(r.arguments=""),e.message.function_call.arguments+=p.arguments)):e.message.function_call=p),o&&(e.message.content=(e.message.content||"")+o,!e.message.refusal&&tY(this,C,"m",H).call(this)&&(e.message.parsed=rk(e.message.content))),m)for(let{index:t,id:s,type:r,function:i,...a}of(e.message.tool_calls||(e.message.tool_calls=[]),m)){let o=(n=e.message.tool_calls)[t]??(n[t]={});Object.assign(o,a),s&&(o.id=s),r&&(o.type=r),i&&(o.function??(o.function={name:i.name??"",arguments:""})),i?.name&&(o.function.name=i.name),i?.arguments&&(o.function.arguments+=i.arguments,function(e,t){if(!e||!("tools"in e)||!e.tools)return!1;let s=e.tools?.find(e=>rh(e)&&e.function?.name===t.function.name);return rh(s)&&(rd(s)||s?.function.strict||!1)}(tY(this,j,"f"),o)&&(o.function.parsed_arguments=rk(o.function.arguments)))}}return i},Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("chunk",s=>{let r=t.shift();r?r.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),this.on("error",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new sF(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function r$(e){return JSON.stringify(e)}function rA(e){}function rO(e){}class rE extends rR{static fromReadableStream(e){let t=new rE(null);return t._run(()=>t._fromReadableStream(e)),t}static runTools(e,t,s){let r=new rE(t),n={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,t,n)),r}}class rI extends ri{constructor(){super(...arguments),this.messages=new rc(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(rl`/chat/completions/${e}`,t)}update(e,t,s){return this._client.post(rl`/chat/completions/${e}`,{body:t,...s})}list(e={},t){return this._client.getAPIList("/chat/completions",sZ,{query:e,...t})}delete(e,t){return this._client.delete(rl`/chat/completions/${e}`,t)}parse(e,t){for(let t of e.tools??[]){if("function"!==t.type)throw new t2(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(!0!==t.function.strict)throw new t2(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}return this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(t=>rp(t,e))}runTools(e,t){return e.stream?rE.runTools(this._client,e,t):rb.runTools(this._client,e,t)}stream(e,t){return rR.createChatCompletion(this._client,e,t)}}rI.Messages=rc;class rP extends ri{constructor(){super(...arguments),this.completions=new rI(this._client)}}rP.Completions=rI,e.s([],98546);let rT=Symbol("brand.privateNullableHeaders"),rM=e=>{let t=new Headers,s=new Set;for(let r of e){let e=new Set;for(let[n,i]of function*(e){let t;if(!e)return;if(rT in e){let{values:t,nulls:s}=e;for(let e of(yield*t.entries(),s))yield[e,null];return}let s=!1;for(let r of(e instanceof Headers?t=e.entries():sh(e)?t=e:(s=!0,t=Object.entries(e??{})),t)){let e=r[0];if("string"!=typeof e)throw TypeError("expected header name to be a string");let t=sh(r[1])?r[1]:[r[1]],n=!1;for(let r of t)void 0!==r&&(s&&!n&&(n=!0,yield[e,null]),yield[e,r])}}(r)){let r=n.toLowerCase();e.has(r)||(t.delete(n),e.add(r)),null===i?(t.delete(n),s.add(r)):(t.append(n,i),s.delete(r))}}return{[rT]:!0,values:t,nulls:s}};class rC extends ri{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:rM([{Accept:"application/octet-stream"},t?.headers]),__binaryResponse:!0})}}class rj extends ri{create(e,t){return this._client.post("/audio/transcriptions",s3({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}}class rN extends ri{create(e,t){return this._client.post("/audio/translations",s3({body:e,...t,__metadata:{model:e.model}},this._client))}}class rL extends ri{constructor(){super(...arguments),this.transcriptions=new rj(this._client),this.translations=new rN(this._client),this.speech=new rC(this._client)}}rL.Transcriptions=rj,rL.Translations=rN,rL.Speech=rC;class rq extends ri{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(rl`/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/batches",sZ,{query:e,...t})}cancel(e,t){return this._client.post(rl`/batches/${e}/cancel`,t)}}class rW extends ri{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:rM([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(rl`/assistants/${e}`,{...t,headers:rM([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,s){return this._client.post(rl`/assistants/${e}`,{body:t,...s,headers:rM([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e={},t){return this._client.getAPIList("/assistants",sZ,{query:e,...t,headers:rM([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(rl`/assistants/${e}`,{...t,headers:rM([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class rD extends ri{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:rM([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class rU extends ri{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:rM([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class rB extends ri{constructor(){super(...arguments),this.sessions=new rD(this._client),this.transcriptionSessions=new rU(this._client)}}rB.Sessions=rD,rB.TranscriptionSessions=rU;class rF extends ri{create(e,t){return this._client.post("/chatkit/sessions",{body:e,...t,headers:rM([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}cancel(e,t){return this._client.post(rl`/chatkit/sessions/${e}/cancel`,{...t,headers:rM([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}}class rH extends ri{retrieve(e,t){return this._client.get(rl`/chatkit/threads/${e}`,{...t,headers:rM([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}list(e={},t){return this._client.getAPIList("/chatkit/threads",s0,{query:e,...t,headers:rM([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}delete(e,t){return this._client.delete(rl`/chatkit/threads/${e}`,{...t,headers:rM([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}listItems(e,t={},s){return this._client.getAPIList(rl`/chatkit/threads/${e}/items`,s0,{query:t,...s,headers:rM([{"OpenAI-Beta":"chatkit_beta=v1"},s?.headers])})}}class rX extends ri{constructor(){super(...arguments),this.sessions=new rF(this._client),this.threads=new rH(this._client)}}rX.Sessions=rF,rX.Threads=rH;class rJ extends ri{create(e,t,s){return this._client.post(rl`/threads/${e}/messages`,{body:t,...s,headers:rM([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,t,s){let{thread_id:r}=t;return this._client.get(rl`/threads/${r}/messages/${e}`,{...s,headers:rM([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,t,s){let{thread_id:r,...n}=t;return this._client.post(rl`/threads/${r}/messages/${e}`,{body:n,...s,headers:rM([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t={},s){return this._client.getAPIList(rl`/threads/${e}/messages`,sZ,{query:t,...s,headers:rM([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(e,t,s){let{thread_id:r}=t;return this._client.delete(rl`/threads/${r}/messages/${e}`,{...s,headers:rM([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}class rK extends ri{retrieve(e,t,s){let{thread_id:r,run_id:n,...i}=t;return this._client.get(rl`/threads/${r}/runs/${n}/steps/${e}`,{query:i,...s,headers:rM([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t,s){let{thread_id:r,...n}=t;return this._client.getAPIList(rl`/threads/${r}/runs/${e}/steps`,sZ,{query:n,...s,headers:rM([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}let rV=e=>void 0!==globalThis.process?globalThis.process.env?.[e]?.trim()??void 0:void 0!==globalThis.Deno?globalThis.Deno.env?.get?.(e)?.trim():void 0;class rz extends rw{constructor(){super(...arguments),J.add(this),V.set(this,[]),z.set(this,{}),G.set(this,{}),Q.set(this,void 0),Y.set(this,void 0),Z.set(this,void 0),ee.set(this,void 0),et.set(this,void 0),es.set(this,void 0),er.set(this,void 0),en.set(this,void 0),ei.set(this,void 0)}[(V=new WeakMap,z=new WeakMap,G=new WeakMap,Q=new WeakMap,Y=new WeakMap,Z=new WeakMap,ee=new WeakMap,et=new WeakMap,es=new WeakMap,er=new WeakMap,en=new WeakMap,ei=new WeakMap,J=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("event",s=>{let r=t.shift();r?r.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),this.on("error",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let t=new K;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){let s=t?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),this._connected();let r=sF.fromReadableStream(e,this.controller);for await(let e of r)tY(this,J,"m",ea).call(this,e);if(r.controller.signal?.aborted)throw new t5;return this._addRun(tY(this,J,"m",eo).call(this))}toReadableStream(){return new sF(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,s,r){let n=new K;return n._run(()=>n._runToolAssistantStream(e,t,s,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),n}async _createToolAssistantStream(e,t,s,r){let n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort()));let i={...s,stream:!0},a=await e.submitToolOutputs(t,i,{...r,signal:this.controller.signal});for await(let e of(this._connected(),a))tY(this,J,"m",ea).call(this,e);if(a.controller.signal?.aborted)throw new t5;return this._addRun(tY(this,J,"m",eo).call(this))}static createThreadAssistantStream(e,t,s){let r=new K;return r._run(()=>r._threadAssistantStream(e,t,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),r}static createAssistantStream(e,t,s,r){let n=new K;return n._run(()=>n._runAssistantStream(e,t,s,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),n}currentEvent(){return tY(this,er,"f")}currentRun(){return tY(this,en,"f")}currentMessageSnapshot(){return tY(this,Q,"f")}currentRunStepSnapshot(){return tY(this,ei,"f")}async finalRunSteps(){return await this.done(),Object.values(tY(this,z,"f"))}async finalMessages(){return await this.done(),Object.values(tY(this,G,"f"))}async finalRun(){if(await this.done(),!tY(this,Y,"f"))throw Error("Final run was not received.");return tY(this,Y,"f")}async _createThreadAssistantStream(e,t,s){let r=s?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));let n={...t,stream:!0},i=await e.createAndRun(n,{...s,signal:this.controller.signal});for await(let e of(this._connected(),i))tY(this,J,"m",ea).call(this,e);if(i.controller.signal?.aborted)throw new t5;return this._addRun(tY(this,J,"m",eo).call(this))}async _createAssistantStream(e,t,s,r){let n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort()));let i={...s,stream:!0},a=await e.create(t,i,{...r,signal:this.controller.signal});for await(let e of(this._connected(),a))tY(this,J,"m",ea).call(this,e);if(a.controller.signal?.aborted)throw new t5;return this._addRun(tY(this,J,"m",eo).call(this))}static accumulateDelta(e,t){for(let[s,r]of Object.entries(t)){if(!e.hasOwnProperty(s)){e[s]=r;continue}let t=e[s];if(null==t||"index"===s||"type"===s){e[s]=r;continue}if("string"==typeof t&&"string"==typeof r)t+=r;else if("number"==typeof t&&"number"==typeof r)t+=r;else if(sd(t)&&sd(r))t=this.accumulateDelta(t,r);else if(Array.isArray(t)&&Array.isArray(r)){if(t.every(e=>"string"==typeof e||"number"==typeof e)){t.push(...r);continue}for(let e of r){if(!sd(e))throw Error(`Expected array delta entry to be an object but got: ${e}`);let s=e.index;if(null==s)throw console.error(e),Error("Expected array delta entry to have an `index` property");if("number"!=typeof s)throw Error(`Expected array delta entry \`index\` property to be a number but got ${s}`);let r=t[s];null==r?t.push(e):t[s]=this.accumulateDelta(r,e)}continue}else throw Error(`Unhandled record type: ${s}, deltaValue: ${r}, accValue: ${t}`);e[s]=t}return e}_addRun(e){return e}async _threadAssistantStream(e,t,s){return await this._createThreadAssistantStream(t,e,s)}async _runAssistantStream(e,t,s,r){return await this._createAssistantStream(t,e,s,r)}async _runToolAssistantStream(e,t,s,r){return await this._createToolAssistantStream(t,e,s,r)}}K=rz,ea=function(e){if(!this.ended)switch(tQ(this,er,e,"f"),tY(this,J,"m",eh).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":tY(this,J,"m",ef).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":tY(this,J,"m",ec).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":tY(this,J,"m",el).call(this,e);break;case"error":throw Error("Encountered an error event in event processing - errors should be processed earlier")}},eo=function(){if(this.ended)throw new t2("stream has ended, this shouldn't happen");if(!tY(this,Y,"f"))throw Error("Final run has not been received");return tY(this,Y,"f")},el=function(e){let[t,s]=tY(this,J,"m",ed).call(this,e,tY(this,Q,"f"));for(let e of(tQ(this,Q,t,"f"),tY(this,G,"f")[t.id]=t,s)){let s=t.content[e.index];s?.type=="text"&&this._emit("textCreated",s.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(let s of e.data.delta.content){if("text"==s.type&&s.text){let e=s.text,r=t.content[s.index];if(r&&"text"==r.type)this._emit("textDelta",e,r.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=tY(this,Z,"f")){if(tY(this,ee,"f"))switch(tY(this,ee,"f").type){case"text":this._emit("textDone",tY(this,ee,"f").text,tY(this,Q,"f"));break;case"image_file":this._emit("imageFileDone",tY(this,ee,"f").image_file,tY(this,Q,"f"))}tQ(this,Z,s.index,"f")}tQ(this,ee,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==tY(this,Z,"f")){let t=e.data.content[tY(this,Z,"f")];if(t)switch(t.type){case"image_file":this._emit("imageFileDone",t.image_file,tY(this,Q,"f"));break;case"text":this._emit("textDone",t.text,tY(this,Q,"f"))}}tY(this,Q,"f")&&this._emit("messageDone",e.data),tQ(this,Q,void 0,"f")}},ec=function(e){let t=tY(this,J,"m",eu).call(this,e);switch(tQ(this,ei,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let s=e.data.delta;if(s.step_details&&"tool_calls"==s.step_details.type&&s.step_details.tool_calls&&"tool_calls"==t.step_details.type)for(let e of s.step_details.tool_calls)e.index==tY(this,et,"f")?this._emit("toolCallDelta",e,t.step_details.tool_calls[e.index]):(tY(this,es,"f")&&this._emit("toolCallDone",tY(this,es,"f")),tQ(this,et,e.index,"f"),tQ(this,es,t.step_details.tool_calls[e.index],"f"),tY(this,es,"f")&&this._emit("toolCallCreated",tY(this,es,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":tQ(this,ei,void 0,"f"),"tool_calls"==e.data.step_details.type&&tY(this,es,"f")&&(this._emit("toolCallDone",tY(this,es,"f")),tQ(this,es,void 0,"f")),this._emit("runStepDone",e.data,t)}},eh=function(e){tY(this,V,"f").push(e),this._emit("event",e)},eu=function(e){switch(e.event){case"thread.run.step.created":return tY(this,z,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=tY(this,z,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let s=e.data;if(s.delta){let r=K.accumulateDelta(t,s.delta);tY(this,z,"f")[e.data.id]=r}return tY(this,z,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":tY(this,z,"f")[e.data.id]=e.data}if(tY(this,z,"f")[e.data.id])return tY(this,z,"f")[e.data.id];throw Error("No snapshot available")},ed=function(e,t){let s=[];switch(e.event){case"thread.message.created":return[e.data,s];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let r=e.data;if(r.delta.content)for(let e of r.delta.content)if(e.index in t.content){let s=t.content[e.index];t.content[e.index]=tY(this,J,"m",ep).call(this,e,s)}else t.content[e.index]=e,s.push(e);return[t,s];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,s];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},ep=function(e,t){return K.accumulateDelta(t,e)},ef=function(e){switch(tQ(this,en,e.data,"f"),e.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":tQ(this,Y,e.data,"f"),tY(this,es,"f")&&(this._emit("toolCallDone",tY(this,es,"f")),tQ(this,es,void 0,"f"))}};class rG extends ri{constructor(){super(...arguments),this.steps=new rK(this._client)}create(e,t,s){let{include:r,...n}=t;return this._client.post(rl`/threads/${e}/runs`,{query:{include:r},body:n,...s,headers:rM([{"OpenAI-Beta":"assistants=v2"},s?.headers]),stream:t.stream??!1})}retrieve(e,t,s){let{thread_id:r}=t;return this._client.get(rl`/threads/${r}/runs/${e}`,{...s,headers:rM([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,t,s){let{thread_id:r,...n}=t;return this._client.post(rl`/threads/${r}/runs/${e}`,{body:n,...s,headers:rM([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t={},s){return this._client.getAPIList(rl`/threads/${e}/runs`,sZ,{query:t,...s,headers:rM([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}cancel(e,t,s){let{thread_id:r}=t;return this._client.post(rl`/threads/${r}/runs/${e}/cancel`,{...s,headers:rM([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(e,t,s){let r=await this.create(e,t,s);return await this.poll(r.id,{thread_id:e},s)}createAndStream(e,t,s){return rz.createAssistantStream(e,this._client.beta.threads.runs,t,s)}async poll(e,t,s){let r=rM([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:n,response:i}=await this.retrieve(e,t,{...s,headers:{...s?.headers,...r}}).withResponse();switch(n.status){case"queued":case"in_progress":case"cancelling":let a=5e3;if(s?.pollIntervalMs)a=s.pollIntervalMs;else{let e=i.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(a=t)}}await sp(a);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return n}}}stream(e,t,s){return rz.createAssistantStream(e,this._client.beta.threads.runs,t,s)}submitToolOutputs(e,t,s){let{thread_id:r,...n}=t;return this._client.post(rl`/threads/${r}/runs/${e}/submit_tool_outputs`,{body:n,...s,headers:rM([{"OpenAI-Beta":"assistants=v2"},s?.headers]),stream:t.stream??!1})}async submitToolOutputsAndPoll(e,t,s){let r=await this.submitToolOutputs(e,t,s);return await this.poll(r.id,t,s)}submitToolOutputsStream(e,t,s){return rz.createToolAssistantStream(e,this._client.beta.threads.runs,t,s)}}rG.Steps=rK;class rQ extends ri{constructor(){super(...arguments),this.runs=new rG(this._client),this.messages=new rJ(this._client)}create(e={},t){return this._client.post("/threads",{body:e,...t,headers:rM([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(rl`/threads/${e}`,{...t,headers:rM([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,s){return this._client.post(rl`/threads/${e}`,{body:t,...s,headers:rM([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(e,t){return this._client.delete(rl`/threads/${e}`,{...t,headers:rM([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:rM([{"OpenAI-Beta":"assistants=v2"},t?.headers]),stream:e.stream??!1})}async createAndRunPoll(e,t){let s=await this.createAndRun(e,t);return await this.runs.poll(s.id,{thread_id:s.thread_id},t)}createAndRunStream(e,t){return rz.createThreadAssistantStream(e,this._client.beta.threads,t)}}rQ.Runs=rG,rQ.Messages=rJ;class rY extends ri{constructor(){super(...arguments),this.realtime=new rB(this._client),this.chatkit=new rX(this._client),this.assistants=new rW(this._client),this.threads=new rQ(this._client)}}rY.Realtime=rB,rY.ChatKit=rX,rY.Assistants=rW,rY.Threads=rQ;class rZ extends ri{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class r0 extends ri{retrieve(e,t,s){let{container_id:r}=t;return this._client.get(rl`/containers/${r}/files/${e}/content`,{...s,headers:rM([{Accept:"application/binary"},s?.headers]),__binaryResponse:!0})}}class r1 extends ri{constructor(){super(...arguments),this.content=new r0(this._client)}create(e,t,s){return this._client.post(rl`/containers/${e}/files`,s3({body:t,...s},this._client))}retrieve(e,t,s){let{container_id:r}=t;return this._client.get(rl`/containers/${r}/files/${e}`,s)}list(e,t={},s){return this._client.getAPIList(rl`/containers/${e}/files`,sZ,{query:t,...s})}delete(e,t,s){let{container_id:r}=t;return this._client.delete(rl`/containers/${r}/files/${e}`,{...s,headers:rM([{Accept:"*/*"},s?.headers])})}}r1.Content=r0;class r2 extends ri{constructor(){super(...arguments),this.files=new r1(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(rl`/containers/${e}`,t)}list(e={},t){return this._client.getAPIList("/containers",sZ,{query:e,...t})}delete(e,t){return this._client.delete(rl`/containers/${e}`,{...t,headers:rM([{Accept:"*/*"},t?.headers])})}}r2.Files=r1;class r4 extends ri{create(e,t,s){let{include:r,...n}=t;return this._client.post(rl`/conversations/${e}/items`,{query:{include:r},body:n,...s})}retrieve(e,t,s){let{conversation_id:r,...n}=t;return this._client.get(rl`/conversations/${r}/items/${e}`,{query:n,...s})}list(e,t={},s){return this._client.getAPIList(rl`/conversations/${e}/items`,s0,{query:t,...s})}delete(e,t,s){let{conversation_id:r}=t;return this._client.delete(rl`/conversations/${r}/items/${e}`,s)}}class r5 extends ri{constructor(){super(...arguments),this.items=new r4(this._client)}create(e={},t){return this._client.post("/conversations",{body:e,...t})}retrieve(e,t){return this._client.get(rl`/conversations/${e}`,t)}update(e,t,s){return this._client.post(rl`/conversations/${e}`,{body:t,...s})}delete(e,t){return this._client.delete(rl`/conversations/${e}`,t)}}r5.Items=r4;class r6 extends ri{create(e,t){let s=!!e.encoding_format,r=s?e.encoding_format:"base64";s&&sU(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);let n=this._client.post("/embeddings",{body:{...e,encoding_format:r},...t});return s?n:(sU(this._client).debug("embeddings/decoding base64 embeddings from base64"),n._thenUnwrap(e=>(e&&e.data&&e.data.forEach(e=>{let t=e.embedding;e.embedding=(e=>{if("undefined"!=typeof Buffer){let t=Buffer.from(e,"base64");return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}{let t=atob(e),s=t.length,r=new Uint8Array(s);for(let e=0;e<s;e++)r[e]=t.charCodeAt(e);return Array.from(new Float32Array(r.buffer))}})(t)}),e)))}}class r3 extends ri{retrieve(e,t,s){let{eval_id:r,run_id:n}=t;return this._client.get(rl`/evals/${r}/runs/${n}/output_items/${e}`,s)}list(e,t,s){let{eval_id:r,...n}=t;return this._client.getAPIList(rl`/evals/${r}/runs/${e}/output_items`,sZ,{query:n,...s})}}class r8 extends ri{constructor(){super(...arguments),this.outputItems=new r3(this._client)}create(e,t,s){return this._client.post(rl`/evals/${e}/runs`,{body:t,...s})}retrieve(e,t,s){let{eval_id:r}=t;return this._client.get(rl`/evals/${r}/runs/${e}`,s)}list(e,t={},s){return this._client.getAPIList(rl`/evals/${e}/runs`,sZ,{query:t,...s})}delete(e,t,s){let{eval_id:r}=t;return this._client.delete(rl`/evals/${r}/runs/${e}`,s)}cancel(e,t,s){let{eval_id:r}=t;return this._client.post(rl`/evals/${r}/runs/${e}`,s)}}r8.OutputItems=r3;class r9 extends ri{constructor(){super(...arguments),this.runs=new r8(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(rl`/evals/${e}`,t)}update(e,t,s){return this._client.post(rl`/evals/${e}`,{body:t,...s})}list(e={},t){return this._client.getAPIList("/evals",sZ,{query:e,...t})}delete(e,t){return this._client.delete(rl`/evals/${e}`,t)}}r9.Runs=r8;class r7 extends ri{create(e,t){return this._client.post("/files",s3({body:e,...t},this._client))}retrieve(e,t){return this._client.get(rl`/files/${e}`,t)}list(e={},t){return this._client.getAPIList("/files",sZ,{query:e,...t})}delete(e,t){return this._client.delete(rl`/files/${e}`,t)}content(e,t){return this._client.get(rl`/files/${e}/content`,{...t,headers:rM([{Accept:"application/binary"},t?.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:s=18e5}={}){let r=new Set(["processed","error","deleted"]),n=Date.now(),i=await this.retrieve(e);for(;!i.status||!r.has(i.status);)if(await sp(t),i=await this.retrieve(e),Date.now()-n>s)throw new t3({message:`Giving up on waiting for file ${e} to finish processing after ${s} milliseconds.`});return i}}class ne extends ri{}class nt extends ri{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}}class ns extends ri{constructor(){super(...arguments),this.graders=new nt(this._client)}}ns.Graders=nt;class nr extends ri{create(e,t,s){return this._client.getAPIList(rl`/fine_tuning/checkpoints/${e}/permissions`,sY,{body:t,method:"post",...s})}retrieve(e,t={},s){return this._client.get(rl`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...s})}delete(e,t,s){let{fine_tuned_model_checkpoint:r}=t;return this._client.delete(rl`/fine_tuning/checkpoints/${r}/permissions/${e}`,s)}}class nn extends ri{constructor(){super(...arguments),this.permissions=new nr(this._client)}}nn.Permissions=nr;class ni extends ri{list(e,t={},s){return this._client.getAPIList(rl`/fine_tuning/jobs/${e}/checkpoints`,sZ,{query:t,...s})}}class na extends ri{constructor(){super(...arguments),this.checkpoints=new ni(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(rl`/fine_tuning/jobs/${e}`,t)}list(e={},t){return this._client.getAPIList("/fine_tuning/jobs",sZ,{query:e,...t})}cancel(e,t){return this._client.post(rl`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},s){return this._client.getAPIList(rl`/fine_tuning/jobs/${e}/events`,sZ,{query:t,...s})}pause(e,t){return this._client.post(rl`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(rl`/fine_tuning/jobs/${e}/resume`,t)}}na.Checkpoints=ni;class no extends ri{constructor(){super(...arguments),this.methods=new ne(this._client),this.jobs=new na(this._client),this.checkpoints=new nn(this._client),this.alpha=new ns(this._client)}}no.Methods=ne,no.Jobs=na,no.Checkpoints=nn,no.Alpha=ns;class nl extends ri{}class nc extends ri{constructor(){super(...arguments),this.graderModels=new nl(this._client)}}nc.GraderModels=nl;class nh extends ri{createVariation(e,t){return this._client.post("/images/variations",s3({body:e,...t},this._client))}edit(e,t){return this._client.post("/images/edits",s3({body:e,...t,stream:e.stream??!1},this._client))}generate(e,t){return this._client.post("/images/generations",{body:e,...t,stream:e.stream??!1})}}class nu extends ri{retrieve(e,t){return this._client.get(rl`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",sY,e)}delete(e,t){return this._client.delete(rl`/models/${e}`,t)}}class nd extends ri{create(e,t){return this._client.post("/moderations",{body:e,...t})}}class np extends ri{accept(e,t,s){return this._client.post(rl`/realtime/calls/${e}/accept`,{body:t,...s,headers:rM([{Accept:"*/*"},s?.headers])})}hangup(e,t){return this._client.post(rl`/realtime/calls/${e}/hangup`,{...t,headers:rM([{Accept:"*/*"},t?.headers])})}refer(e,t,s){return this._client.post(rl`/realtime/calls/${e}/refer`,{body:t,...s,headers:rM([{Accept:"*/*"},s?.headers])})}reject(e,t={},s){return this._client.post(rl`/realtime/calls/${e}/reject`,{body:t,...s,headers:rM([{Accept:"*/*"},s?.headers])})}}class nf extends ri{create(e,t){return this._client.post("/realtime/client_secrets",{body:e,...t})}}class nm extends ri{constructor(){super(...arguments),this.clientSecrets=new nf(this._client),this.calls=new np(this._client)}}function ng(e,t){let s=e.output.map(e=>{if("function_call"===e.type)return{...e,parsed_arguments:function(e,t){var s,r;let n=(s=e.tools??[],r=t.name,s.find(e=>"function"===e.type&&e.name===r));return{...t,...t,parsed_arguments:n?.$brand==="auto-parseable-tool"?n.$parseRaw(t.arguments):n?.strict?JSON.parse(t.arguments):null}}(t,e)};if("message"===e.type){let s=e.content.map(e=>{var s,r;return"output_text"===e.type?{...e,parsed:(s=t,r=e.text,s.text?.format?.type!=="json_schema"?null:"$parseRaw"in s.text?.format?(s.text?.format).$parseRaw(r):JSON.parse(r))}:e});return{...e,content:s}}return e}),r=Object.assign({},e,{output:s});return Object.getOwnPropertyDescriptor(e,"output_text")||ny(r),Object.defineProperty(r,"output_parsed",{enumerable:!0,get(){for(let e of r.output)if("message"===e.type){for(let t of e.content)if("output_text"===t.type&&null!==t.parsed)return t.parsed}return null}}),r}function ny(e){let t=[];for(let s of e.output)if("message"===s.type)for(let e of s.content)"output_text"===e.type&&t.push(e.text);e.output_text=t.join("")}nm.ClientSecrets=nf,nm.Calls=np;class nw extends rw{constructor(e){super(),em.add(this),eg.set(this,void 0),ey.set(this,void 0),ew.set(this,void 0),tQ(this,eg,e,"f")}static createResponse(e,t,s){let r=new nw(t);return r._run(()=>r._createOrRetrieveResponse(e,t,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createOrRetrieveResponse(e,t,s){let r,n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),tY(this,em,"m",e_).call(this);let i=null;for await(let n of("response_id"in t?(r=await e.responses.retrieve(t.response_id,{stream:!0},{...s,signal:this.controller.signal,stream:!0}),i=t.starting_after??null):r=await e.responses.create({...t,stream:!0},{...s,signal:this.controller.signal}),this._connected(),r))tY(this,em,"m",eb).call(this,n,i);if(r.controller.signal?.aborted)throw new t5;return tY(this,em,"m",ev).call(this)}[(eg=new WeakMap,ey=new WeakMap,ew=new WeakMap,em=new WeakSet,e_=function(){this.ended||tQ(this,ey,void 0,"f")},eb=function(e,t){if(this.ended)return;let s=(e,s)=>{(null==t||s.sequence_number>t)&&this._emit(e,s)},r=tY(this,em,"m",ex).call(this,e);switch(s("event",e),e.type){case"response.output_text.delta":{let t=r.output[e.output_index];if(!t)throw new t2(`missing output at index ${e.output_index}`);if("message"===t.type){let r=t.content[e.content_index];if(!r)throw new t2(`missing content at index ${e.content_index}`);if("output_text"!==r.type)throw new t2(`expected content to be 'output_text', got ${r.type}`);s("response.output_text.delta",{...e,snapshot:r.text})}break}case"response.function_call_arguments.delta":{let t=r.output[e.output_index];if(!t)throw new t2(`missing output at index ${e.output_index}`);"function_call"===t.type&&s("response.function_call_arguments.delta",{...e,snapshot:t.arguments});break}default:s(e.type,e)}},ev=function(){if(this.ended)throw new t2("stream has ended, this shouldn't happen");let e=tY(this,ey,"f");if(!e)throw new t2("request ended without sending any events");tQ(this,ey,void 0,"f");let t=function(e,t){var s;return t&&(s=t,ru(s.text?.format))?ng(e,t):{...e,output_parsed:null,output:e.output.map(e=>"function_call"===e.type?{...e,parsed_arguments:null}:"message"===e.type?{...e,content:e.content.map(e=>({...e,parsed:null}))}:e)}}(e,tY(this,eg,"f"));return tQ(this,ew,t,"f"),t},ex=function(e){let t=tY(this,ey,"f");if(!t){if("response.created"!==e.type)throw new t2(`When snapshot hasn't been set yet, expected 'response.created' event, got ${e.type}`);return tQ(this,ey,e.response,"f")}switch(e.type){case"response.output_item.added":t.output.push(e.item);break;case"response.content_part.added":{let s=t.output[e.output_index];if(!s)throw new t2(`missing output at index ${e.output_index}`);let r=s.type,n=e.part;"message"===r&&"reasoning_text"!==n.type?s.content.push(n):"reasoning"===r&&"reasoning_text"===n.type&&(s.content||(s.content=[]),s.content.push(n));break}case"response.output_text.delta":{let s=t.output[e.output_index];if(!s)throw new t2(`missing output at index ${e.output_index}`);if("message"===s.type){let t=s.content[e.content_index];if(!t)throw new t2(`missing content at index ${e.content_index}`);if("output_text"!==t.type)throw new t2(`expected content to be 'output_text', got ${t.type}`);t.text+=e.delta}break}case"response.function_call_arguments.delta":{let s=t.output[e.output_index];if(!s)throw new t2(`missing output at index ${e.output_index}`);"function_call"===s.type&&(s.arguments+=e.delta);break}case"response.reasoning_text.delta":{let s=t.output[e.output_index];if(!s)throw new t2(`missing output at index ${e.output_index}`);if("reasoning"===s.type){let t=s.content?.[e.content_index];if(!t)throw new t2(`missing content at index ${e.content_index}`);if("reasoning_text"!==t.type)throw new t2(`expected content to be 'reasoning_text', got ${t.type}`);t.text+=e.delta}break}case"response.completed":tQ(this,ey,e.response,"f")}return t},Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("event",s=>{let r=t.shift();r?r.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),this.on("error",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=tY(this,ew,"f");if(!e)throw new t2("stream ended without producing a ChatCompletion");return e}}class n_ extends ri{list(e,t={},s){return this._client.getAPIList(rl`/responses/${e}/input_items`,sZ,{query:t,...s})}}class nb extends ri{count(e={},t){return this._client.post("/responses/input_tokens",{body:e,...t})}}class nv extends ri{constructor(){super(...arguments),this.inputItems=new n_(this._client),this.inputTokens=new nb(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&ny(e),e))}retrieve(e,t={},s){return this._client.get(rl`/responses/${e}`,{query:t,...s,stream:t?.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&ny(e),e))}delete(e,t){return this._client.delete(rl`/responses/${e}`,{...t,headers:rM([{Accept:"*/*"},t?.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(t=>ng(t,e))}stream(e,t){return nw.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(rl`/responses/${e}/cancel`,t)}compact(e,t){return this._client.post("/responses/compact",{body:e,...t})}}nv.InputItems=n_,nv.InputTokens=nb;class nx extends ri{create(e,t,s){return this._client.post(rl`/uploads/${e}/parts`,s3({body:t,...s},this._client))}}class nS extends ri{constructor(){super(...arguments),this.parts=new nx(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(rl`/uploads/${e}/cancel`,t)}complete(e,t,s){return this._client.post(rl`/uploads/${e}/complete`,{body:t,...s})}}nS.Parts=nx;let nk=async e=>{let t=await Promise.allSettled(e),s=t.filter(e=>"rejected"===e.status);if(s.length){for(let e of s)console.error(e.reason);throw Error(`${s.length} promise(s) failed - see the above errors`)}let r=[];for(let e of t)"fulfilled"===e.status&&r.push(e.value);return r};class nR extends ri{create(e,t,s){return this._client.post(rl`/vector_stores/${e}/file_batches`,{body:t,...s,headers:rM([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,t,s){let{vector_store_id:r}=t;return this._client.get(rl`/vector_stores/${r}/file_batches/${e}`,{...s,headers:rM([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}cancel(e,t,s){let{vector_store_id:r}=t;return this._client.post(rl`/vector_stores/${r}/file_batches/${e}/cancel`,{...s,headers:rM([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(e,t,s){let r=await this.create(e,t);return await this.poll(e,r.id,s)}listFiles(e,t,s){let{vector_store_id:r,...n}=t;return this._client.getAPIList(rl`/vector_stores/${r}/file_batches/${e}/files`,sZ,{query:n,...s,headers:rM([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async poll(e,t,s){let r=rM([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:n,response:i}=await this.retrieve(t,{vector_store_id:e},{...s,headers:r}).withResponse();switch(n.status){case"in_progress":let a=5e3;if(s?.pollIntervalMs)a=s.pollIntervalMs;else{let e=i.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(a=t)}}await sp(a);break;case"failed":case"cancelled":case"completed":return n}}}async uploadAndPoll(e,{files:t,fileIds:s=[]},r){if(null==t||0==t.length)throw Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let n=Math.min(r?.maxConcurrency??5,t.length),i=this._client,a=t.values(),o=[...s];async function l(e){for(let t of e){let e=await i.files.create({file:t,purpose:"assistants"},r);o.push(e.id)}}let c=Array(n).fill(a).map(l);return await nk(c),await this.createAndPoll(e,{file_ids:o})}}class n$ extends ri{create(e,t,s){return this._client.post(rl`/vector_stores/${e}/files`,{body:t,...s,headers:rM([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,t,s){let{vector_store_id:r}=t;return this._client.get(rl`/vector_stores/${r}/files/${e}`,{...s,headers:rM([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,t,s){let{vector_store_id:r,...n}=t;return this._client.post(rl`/vector_stores/${r}/files/${e}`,{body:n,...s,headers:rM([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t={},s){return this._client.getAPIList(rl`/vector_stores/${e}/files`,sZ,{query:t,...s,headers:rM([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(e,t,s){let{vector_store_id:r}=t;return this._client.delete(rl`/vector_stores/${r}/files/${e}`,{...s,headers:rM([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(e,t,s){let r=await this.create(e,t,s);return await this.poll(e,r.id,s)}async poll(e,t,s){let r=rM([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){let n=await this.retrieve(t,{vector_store_id:e},{...s,headers:r}).withResponse(),i=n.data;switch(i.status){case"in_progress":let a=5e3;if(s?.pollIntervalMs)a=s.pollIntervalMs;else{let e=n.response.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(a=t)}}await sp(a);break;case"failed":case"completed":return i}}}async upload(e,t,s){let r=await this._client.files.create({file:t,purpose:"assistants"},s);return this.create(e,{file_id:r.id},s)}async uploadAndPoll(e,t,s){let r=await this.upload(e,t,s);return await this.poll(e,r.id,s)}content(e,t,s){let{vector_store_id:r}=t;return this._client.getAPIList(rl`/vector_stores/${r}/files/${e}/content`,sY,{...s,headers:rM([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}class nA extends ri{constructor(){super(...arguments),this.files=new n$(this._client),this.fileBatches=new nR(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:rM([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(rl`/vector_stores/${e}`,{...t,headers:rM([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,s){return this._client.post(rl`/vector_stores/${e}`,{body:t,...s,headers:rM([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e={},t){return this._client.getAPIList("/vector_stores",sZ,{query:e,...t,headers:rM([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(rl`/vector_stores/${e}`,{...t,headers:rM([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}search(e,t,s){return this._client.getAPIList(rl`/vector_stores/${e}/search`,sY,{body:t,method:"post",...s,headers:rM([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}nA.Files=n$,nA.FileBatches=nR;class nO extends ri{create(e,t){return this._client.post("/videos",s6({body:e,...t},this._client))}retrieve(e,t){return this._client.get(rl`/videos/${e}`,t)}list(e={},t){return this._client.getAPIList("/videos",s0,{query:e,...t})}delete(e,t){return this._client.delete(rl`/videos/${e}`,t)}downloadContent(e,t={},s){return this._client.get(rl`/videos/${e}/content`,{query:t,...s,headers:rM([{Accept:"application/binary"},s?.headers]),__binaryResponse:!0})}remix(e,t,s){return this._client.post(rl`/videos/${e}/remix`,s6({body:t,...s},this._client))}}class nE extends ri{constructor(){super(...arguments),eS.add(this)}async unwrap(e,t,s=this._client.webhookSecret,r=300){return await this.verifySignature(e,t,s,r),JSON.parse(e)}async verifySignature(e,t,s=this._client.webhookSecret,r=300){if("undefined"==typeof crypto||"function"!=typeof crypto.subtle.importKey||"function"!=typeof crypto.subtle.verify)throw Error("Webhook signature verification is only supported when the `crypto` global is defined");tY(this,eS,"m",ek).call(this,s);let n=rM([t]).values,i=tY(this,eS,"m",eR).call(this,n,"webhook-signature"),a=tY(this,eS,"m",eR).call(this,n,"webhook-timestamp"),o=tY(this,eS,"m",eR).call(this,n,"webhook-id"),l=parseInt(a,10);if(isNaN(l))throw new so("Invalid webhook timestamp format");let c=Math.floor(Date.now()/1e3);if(c-l>r)throw new so("Webhook timestamp is too old");if(l>c+r)throw new so("Webhook timestamp is too new");let h=i.split(" ").map(e=>e.startsWith("v1,")?e.substring(3):e),u=s.startsWith("whsec_")?Buffer.from(s.replace("whsec_",""),"base64"):Buffer.from(s,"utf-8"),d=o?`${o}.${a}.${e}`:`${a}.${e}`,p=await crypto.subtle.importKey("raw",u,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(let e of h)try{let t=Buffer.from(e,"base64");if(await crypto.subtle.verify("HMAC",p,t,new TextEncoder().encode(d)))return}catch{continue}throw new so("The given webhook signature does not match the expected signature")}}eS=new WeakSet,ek=function(e){if("string"!=typeof e||0===e.length)throw Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},eR=function(e,t){if(!e)throw Error("Headers are required");let s=e.get(t);if(null==s)throw Error(`Missing required header: ${t}`);return s},e.i(98546);class nI{constructor({baseURL:e=rV("OPENAI_BASE_URL"),apiKey:t=rV("OPENAI_API_KEY"),organization:s=rV("OPENAI_ORG_ID")??null,project:r=rV("OPENAI_PROJECT_ID")??null,webhookSecret:n=rV("OPENAI_WEBHOOK_SECRET")??null,...i}={}){if(e$.add(this),eO.set(this,void 0),this.completions=new rZ(this),this.chat=new rP(this),this.embeddings=new r6(this),this.files=new r7(this),this.images=new nh(this),this.audio=new rL(this),this.moderations=new nd(this),this.models=new nu(this),this.fineTuning=new no(this),this.graders=new nc(this),this.vectorStores=new nA(this),this.webhooks=new nE(this),this.beta=new rY(this),this.batches=new rq(this),this.uploads=new nS(this),this.responses=new nv(this),this.realtime=new nm(this),this.conversations=new r5(this),this.evals=new r9(this),this.containers=new r2(this),this.videos=new nO(this),void 0===t)throw new t2("Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.");const a={apiKey:t,organization:s,project:r,webhookSecret:n,...i,baseURL:e||"https://api.openai.com/v1"};a.dangerouslyAllowBrowser,this.baseURL=a.baseURL,this.timeout=a.timeout??eA.DEFAULT_TIMEOUT,this.logger=a.logger??console;const o="warn";this.logLevel=o,this.logLevel=sN(a.logLevel,"ClientOptions.logLevel",this)??sN(rV("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??o,this.fetchOptions=a.fetchOptions,this.maxRetries=a.maxRetries??2,this.fetch=a.fetch??function(){if("undefined"!=typeof fetch)return fetch;throw Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),tQ(this,eO,sv,"f"),this._options=a,this.apiKey="string"==typeof t?t:"Missing Key",this.organization=s,this.project=r,this.webhookSecret=n}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}async authHeaders(e){return rM([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return function(e,t={}){let s,r=e,n=function(e=sI){let t;if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw TypeError("Encoder has to be a function.");let s=e.charset||sI.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let r=sx;if(void 0!==e.format){if(!sR(sk,e.format))throw TypeError("Unknown format option provided.");r=e.format}let n=sk[r],i=sI.filter;if(("function"==typeof e.filter||sc(e.filter))&&(i=e.filter),t=e.arrayFormat&&e.arrayFormat in sO?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":sI.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw TypeError("`commaRoundTrip` must be a boolean, or absent");let a=void 0===e.allowDots?!0==!!e.encodeDotInKeys||sI.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:sI.addQueryPrefix,allowDots:a,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:sI.allowEmptyArrays,arrayFormat:t,charset:s,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:sI.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:void 0===e.delimiter?sI.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:sI.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:sI.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:sI.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:sI.encodeValuesOnly,filter:i,format:r,formatter:n,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:sI.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:sI.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:sI.strictNullHandling}}(t);"function"==typeof n.filter?r=(0,n.filter)("",r):sc(n.filter)&&(s=n.filter);let i=[];if("object"!=typeof r||null===r)return"";let a=sO[n.arrayFormat],o="comma"===a&&n.commaRoundTrip;s||(s=Object.keys(r)),n.sort&&s.sort(n.sort);let l=new WeakMap;for(let e=0;e<s.length;++e){let t=s[e];n.skipNulls&&null===r[t]||sE(i,function e(t,s,r,n,i,a,o,l,c,h,u,d,p,f,m,g,y,w){var _,b;let v,x=t,S=w,k=0,R=!1;for(;void 0!==(S=S.get(sP))&&!R;){let e=S.get(t);if(k+=1,void 0!==e)if(e===k)throw RangeError("Cyclic object value");else R=!0;void 0===S.get(sP)&&(k=0)}if("function"==typeof h?x=h(s,x):x instanceof Date?x=p?.(x):"comma"===r&&sc(x)&&(x=sA(x,function(e){return e instanceof Date?p?.(e):e})),null===x){if(a)return c&&!g?c(s,sI.encoder,y,"key",f):s;x=""}if("string"==typeof(_=x)||"number"==typeof _||"boolean"==typeof _||"symbol"==typeof _||"bigint"==typeof _||(b=x)&&"object"==typeof b&&b.constructor&&b.constructor.isBuffer&&b.constructor.isBuffer(b)){if(c){let e=g?s:c(s,sI.encoder,y,"key",f);return[m?.(e)+"="+m?.(c(x,sI.encoder,y,"value",f))]}return[m?.(s)+"="+m?.(String(x))]}let $=[];if(void 0===x)return $;if("comma"===r&&sc(x))g&&c&&(x=sA(x,c)),v=[{value:x.length>0?x.join(",")||null:void 0}];else if(sc(h))v=h;else{let e=Object.keys(x);v=u?e.sort(u):e}let A=l?String(s).replace(/\./g,"%2E"):String(s),O=n&&sc(x)&&1===x.length?A+"[]":A;if(i&&sc(x)&&0===x.length)return O+"[]";for(let s=0;s<v.length;++s){let _=v[s],b="object"==typeof _&&void 0!==_.value?_.value:x[_];if(o&&null===b)continue;let S=d&&l?_.replace(/\./g,"%2E"):_,R=sc(x)?"function"==typeof r?r(O,S):O:O+(d?"."+S:"["+S+"]");w.set(t,k);let A=new WeakMap;A.set(sP,w),sE($,e(b,R,r,n,i,a,o,l,"comma"===r&&g&&sc(x)?null:c,h,u,d,p,f,m,g,y,A))}return $}(r[t],t,a,o,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,l))}let c=i.join(n.delimiter),h=!0===n.addQueryPrefix?"?":"";return n.charsetSentinel&&("iso-8859-1"===n.charset?h+="utf8=%26%2310003%3B&":h+="utf8=%E2%9C%93&"),c.length>0?h+c:""}(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${sf}`}defaultIdempotencyKey(){return`stainless-node-retry-${tZ()}`}makeStatusError(e,t,s,r){return t4.generate(e,t,s,r)}async _callApiKey(){let e,t=this._options.apiKey;if("function"!=typeof t)return!1;try{e=await t()}catch(e){if(e instanceof t2)throw e;throw new t2(`Failed to get token from 'apiKey' function: ${e.message}`,{cause:e})}if("string"!=typeof e||!e)throw new t2(`Expected 'apiKey' function argument to return a string but it returned ${e}`);return this.apiKey=e,!0}buildURL(e,t,s){let r=!tY(this,e$,"m",eE).call(this)&&s||this.baseURL,n=new URL(sl.test(e)?e:r+(r.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),i=this.defaultQuery();return!function(e){if(!e)return!0;for(let t in e)return!1;return!0}(i)&&(t={...i,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}async prepareOptions(e){await this._callApiKey()}async prepareRequest(e,{url:t,options:s}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,s){return this.request(Promise.resolve(s).then(s=>({method:e,path:t,...s})))}request(e,t=null){return new sz(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,s){let r=await e,n=r.maxRetries??this.maxRetries;null==t&&(t=n),await this.prepareOptions(r);let{req:i,url:a,timeout:o}=await this.buildRequest(r,{retryCount:n-t});await this.prepareRequest(i,{url:a,options:r});let l="log_"+(0x1000000*Math.random()|0).toString(16).padStart(6,"0"),c=void 0===s?"":`, retryOf: ${s}`,h=Date.now();if(sU(this).debug(`[${l}] sending request`,sB({retryOfRequestLogID:s,method:r.method,url:a,options:r,headers:i.headers})),r.signal?.aborted)throw new t5;let u=new AbortController,d=await this.fetchWithTimeout(a,i,o,u).catch(t1),p=Date.now();if(d instanceof globalThis.Error){let e=`retrying, ${t} attempts remaining`;if(r.signal?.aborted)throw new t5;let n=t0(d)||/timed? ?out/i.test(String(d)+("cause"in d?String(d.cause):""));if(t)return sU(this).info(`[${l}] connection ${n?"timed out":"failed"} - ${e}`),sU(this).debug(`[${l}] connection ${n?"timed out":"failed"} (${e})`,sB({retryOfRequestLogID:s,url:a,durationMs:p-h,message:d.message})),this.retryRequest(r,t,s??l);if(sU(this).info(`[${l}] connection ${n?"timed out":"failed"} - error; no more retries left`),sU(this).debug(`[${l}] connection ${n?"timed out":"failed"} (error; no more retries left)`,sB({retryOfRequestLogID:s,url:a,durationMs:p-h,message:d.message})),n)throw new t3;throw new t6({cause:d})}let f=[...d.headers.entries()].filter(([e])=>"x-request-id"===e).map(([e,t])=>", "+e+": "+JSON.stringify(t)).join(""),m=`[${l}${c}${f}] ${i.method} ${a} ${d.ok?"succeeded":"failed"} with status ${d.status} in ${p-h}ms`;if(!d.ok){let e=await this.shouldRetry(d);if(t&&e){let e=`retrying, ${t} attempts remaining`;return await sb(d.body),sU(this).info(`${m} - ${e}`),sU(this).debug(`[${l}] response error (${e})`,sB({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,durationMs:p-h})),this.retryRequest(r,t,s??l,d.headers)}let n=e?"error; no more retries left":"error; not retryable";sU(this).info(`${m} - ${n}`);let i=await d.text().catch(e=>t1(e).message),a=(e=>{try{return JSON.parse(e)}catch(e){return}})(i),o=a?void 0:i;throw sU(this).debug(`[${l}] response error (${n})`,sB({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,message:o,durationMs:Date.now()-h})),this.makeStatusError(d.status,a,o,d.headers)}return sU(this).info(m),sU(this).debug(`[${l}] response start`,sB({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,durationMs:p-h})),{response:d,options:r,controller:u,requestLogID:l,retryOfRequestLogID:s,startTime:h}}getAPIList(e,t,s){return this.requestAPIList(t,{method:"get",path:e,...s})}requestAPIList(e,t){return new sQ(this,this.makeRequest(t,null,void 0),e)}async fetchWithTimeout(e,t,s,r){let{signal:n,method:i,...a}=t||{};n&&n.addEventListener("abort",()=>r.abort());let o=setTimeout(()=>r.abort(),s),l=globalThis.ReadableStream&&a.body instanceof globalThis.ReadableStream||"object"==typeof a.body&&null!==a.body&&Symbol.asyncIterator in a.body,c={signal:r.signal,...l?{duplex:"half"}:{},method:"GET",...a};i&&(c.method=i.toUpperCase());try{return await this.fetch.call(void 0,e,c)}finally{clearTimeout(o)}}async shouldRetry(e){let t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||!!(e.status>=500))}async retryRequest(e,t,s,r){let n,i=r?.get("retry-after-ms");if(i){let e=parseFloat(i);Number.isNaN(e)||(n=e)}let a=r?.get("retry-after");if(a&&!n){let e=parseFloat(a);n=Number.isNaN(e)?Date.parse(a)-Date.now():1e3*e}if(!(n&&0<=n&&n<6e4)){let s=e.maxRetries??this.maxRetries;n=this.calculateDefaultRetryTimeoutMillis(t,s)}return await sp(n),this.makeRequest(e,t-1,s)}calculateDefaultRetryTimeoutMillis(e,t){return Math.min(.5*Math.pow(2,t-e),8)*(1-.25*Math.random())*1e3}async buildRequest(e,{retryCount:t=0}={}){let s={...e},{method:r,path:n,query:i,defaultBaseURL:a}=s,o=this.buildURL(n,i,a);"timeout"in s&&((e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new t2(`${e} must be an integer`);if(t<0)throw new t2(`${e} must be a positive integer`)})("timeout",s.timeout),s.timeout=s.timeout??this.timeout;let{bodyHeaders:l,body:c}=this.buildBody({options:s}),h=await this.buildHeaders({options:e,method:r,bodyHeaders:l,retryCount:t});return{req:{method:r,headers:h,...s.signal&&{signal:s.signal},...globalThis.ReadableStream&&c instanceof globalThis.ReadableStream&&{duplex:"half"},...c&&{body:c},...this.fetchOptions??{},...s.fetchOptions??{}},url:o,timeout:s.timeout}}async buildHeaders({options:e,method:s,bodyHeaders:r,retryCount:n}){let i={};this.idempotencyHeader&&"get"!==s&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=e.idempotencyKey);let a=rM([i,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(n),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...t??(t=(()=>{let e="undefined"!=typeof Deno&&null!=Deno.build?"deno":"undefined"!=typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call(void 0!==globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":sf,"X-Stainless-OS":sg(Deno.build.os),"X-Stainless-Arch":sm(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":sf,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":sf,"X-Stainless-OS":sg(globalThis.process.platform??"unknown"),"X-Stainless-Arch":sm(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let t=function(){if("undefined"==typeof navigator||!navigator)return null;for(let{key:e,pattern:t}of[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let s=t.exec(navigator.userAgent);if(s){let t=s[1]||0,r=s[2]||0,n=s[3]||0;return{browser:e,version:`${t}.${r}.${n}`}}}return null}();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":sf,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":sf,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}})()),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},await this.authHeaders(e),this._options.defaultHeaders,r,e.headers]);return this.validateHeaders(a),a.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let s=rM([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||"string"==typeof e&&s.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:"object"==typeof e&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&"function"==typeof e.next)?{bodyHeaders:void 0,body:sw(e)}:tY(this,eO,"f").call(this,{body:e,headers:s})}}function nP(e,t,s,r,n){if("m"===r)throw TypeError("Private method is not writable");if("a"===r&&!n)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?n.call(e,s):n?n.value=s:t.set(e,s),s}function nT(e,t,s,r){if("a"===s&&!r)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?r:"a"===s?r.call(e):r?r.value:t.get(e)}eA=nI,eO=new WeakMap,e$=new WeakSet,eE=function(){return"https://api.openai.com/v1"!==this.baseURL},nI.OpenAI=eA,nI.DEFAULT_TIMEOUT=6e5,nI.OpenAIError=t2,nI.APIError=t4,nI.APIConnectionError=t6,nI.APIConnectionTimeoutError=t3,nI.APIUserAbortError=t5,nI.NotFoundError=se,nI.ConflictError=st,nI.RateLimitError=sr,nI.BadRequestError=t8,nI.AuthenticationError=t9,nI.InternalServerError=sn,nI.PermissionDeniedError=t7,nI.UnprocessableEntityError=ss,nI.InvalidWebhookSignatureError=so,nI.toFile=rr,nI.Completions=rZ,nI.Chat=rP,nI.Embeddings=r6,nI.Files=r7,nI.Images=nh,nI.Audio=rL,nI.Moderations=nd,nI.Models=nu,nI.FineTuning=no,nI.Graders=nc,nI.VectorStores=nA,nI.Webhooks=nE,nI.Beta=rY,nI.Batches=rq,nI.Uploads=nS,nI.Responses=nv,nI.Realtime=nm,nI.Conversations=r5,nI.Evals=r9,nI.Containers=r2,nI.Videos=nO;let nM=function(){let{crypto:e}=globalThis;if(e?.randomUUID)return nM=e.randomUUID.bind(e),e.randomUUID();let t=new Uint8Array(1),s=e?()=>e.getRandomValues(t)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(e^s()&15>>e/4).toString(16))};function nC(e){return"object"==typeof e&&null!==e&&("name"in e&&"AbortError"===e.name||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}let nj=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e){try{if("[object Error]"===Object.prototype.toString.call(e)){let t=Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return Error(JSON.stringify(e))}catch{}}return Error(e)};class nN extends Error{}class nL extends nN{constructor(e,t,s,r){super(`${nL.makeMessage(e,t,s)}`),this.status=e,this.headers=r,this.requestID=r?.get("request-id"),this.error=t}static makeMessage(e,t,s){let r=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):s;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||"(no status code or body)"}static generate(e,t,s,r){return e&&r?400===e?new nU(e,t,s,r):401===e?new nB(e,t,s,r):403===e?new nF(e,t,s,r):404===e?new nH(e,t,s,r):409===e?new nX(e,t,s,r):422===e?new nJ(e,t,s,r):429===e?new nK(e,t,s,r):e>=500?new nV(e,t,s,r):new nL(e,t,s,r):new nW({message:s,cause:nj(t)})}}class nq extends nL{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class nW extends nL{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class nD extends nW{constructor({message:e}={}){super({message:e??"Request timed out."})}}class nU extends nL{}class nB extends nL{}class nF extends nL{}class nH extends nL{}class nX extends nL{}class nJ extends nL{}class nK extends nL{}class nV extends nL{}let nz=/^[a-z][a-z0-9+.-]*:/i,nG=e=>(nG=Array.isArray)(e),nQ=nG;function nY(e){return"object"!=typeof e?{}:e??{}}let nZ=e=>{try{return JSON.parse(e)}catch(e){return}},n0="0.71.2",n1=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",n2=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown";function n4(...e){let t=globalThis.ReadableStream;if(void 0===t)throw Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function n5(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return n4({start(){},async pull(e){let{done:s,value:r}=await t.next();s?e.close():e.enqueue(r)},async cancel(){await t.return?.()}})}function n6(e){if(e[Symbol.asyncIterator])return e;let t=e.getReader();return{async next(){try{let e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){let e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function n3(e){if(null===e||"object"!=typeof e)return;if(e[Symbol.asyncIterator])return void await e[Symbol.asyncIterator]().return?.();let t=e.getReader(),s=t.cancel();t.releaseLock(),await s}let n8=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)});function n9(e){let t;return(a??(a=(t=new globalThis.TextEncoder).encode.bind(t)))(e)}function n7(e){let t;return(o??(o=(t=new globalThis.TextDecoder).decode.bind(t)))(e)}class ie{constructor(){eI.set(this,void 0),eP.set(this,void 0),nP(this,eI,new Uint8Array,"f"),nP(this,eP,null,"f")}decode(e){let t;if(null==e)return[];let s=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?n9(e):e;nP(this,eI,function(e){let t=0;for(let s of e)t+=s.length;let s=new Uint8Array(t),r=0;for(let t of e)s.set(t,r),r+=t.length;return s}([nT(this,eI,"f"),s]),"f");let r=[];for(;null!=(t=function(e,t){for(let s=t??0;s<e.length;s++){if(10===e[s])return{preceding:s,index:s+1,carriage:!1};if(13===e[s])return{preceding:s,index:s+1,carriage:!0}}return null}(nT(this,eI,"f"),nT(this,eP,"f")));){if(t.carriage&&null==nT(this,eP,"f")){nP(this,eP,t.index,"f");continue}if(null!=nT(this,eP,"f")&&(t.index!==nT(this,eP,"f")+1||t.carriage)){r.push(n7(nT(this,eI,"f").subarray(0,nT(this,eP,"f")-1))),nP(this,eI,nT(this,eI,"f").subarray(nT(this,eP,"f")),"f"),nP(this,eP,null,"f");continue}let e=null!==nT(this,eP,"f")?t.preceding-1:t.preceding,s=n7(nT(this,eI,"f").subarray(0,e));r.push(s),nP(this,eI,nT(this,eI,"f").subarray(t.index),"f"),nP(this,eP,null,"f")}return r}flush(){return nT(this,eI,"f").length?this.decode("\n"):[]}}eI=new WeakMap,eP=new WeakMap,ie.NEWLINE_CHARS=new Set(["\n","\r"]),ie.NEWLINE_REGEXP=/\r\n|[\n\r]/g;let it={off:0,error:200,warn:300,info:400,debug:500},is=(e,t,s)=>{if(e){if(Object.prototype.hasOwnProperty.call(it,e))return e;il(s).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(it))}`)}};function ir(){}function ii(e,t,s){return!t||it[e]>it[s]?ir:t[e].bind(t)}let ia={error:ir,warn:ir,info:ir,debug:ir},io=new WeakMap;function il(e){let t=e.logger,s=e.logLevel??"off";if(!t)return ia;let r=io.get(t);if(r&&r[0]===s)return r[1];let n={error:ii("error",t,s),warn:ii("warn",t,s),info:ii("info",t,s),debug:ii("debug",t,s)};return io.set(t,[s,n]),n}let ic=e=>(e.options&&(e.options={...e.options},delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([e,t])=>[e,"x-api-key"===e.toLowerCase()||"authorization"===e.toLowerCase()||"cookie"===e.toLowerCase()||"set-cookie"===e.toLowerCase()?"***":t]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);class ih{constructor(e,t,s){this.iterator=e,eT.set(this,void 0),this.controller=t,nP(this,eT,s,"f")}static fromSSEResponse(e,t,s){let r=!1,n=s?il(s):console;async function*i(){if(r)throw new nN("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let s=!1;try{for await(let s of iu(e,t)){if("completion"===s.event)try{yield JSON.parse(s.data)}catch(e){throw n.error("Could not parse message into JSON:",s.data),n.error("From chunk:",s.raw),e}if("message_start"===s.event||"message_delta"===s.event||"message_stop"===s.event||"content_block_start"===s.event||"content_block_delta"===s.event||"content_block_stop"===s.event)try{yield JSON.parse(s.data)}catch(e){throw n.error("Could not parse message into JSON:",s.data),n.error("From chunk:",s.raw),e}if("ping"!==s.event&&"error"===s.event)throw new nL(void 0,nZ(s.data)??s.data,void 0,e.headers)}s=!0}catch(e){if(nC(e))return;throw e}finally{s||t.abort()}}return new ih(i,t,s)}static fromReadableStream(e,t,s){let r=!1;async function*n(){let t=new ie;for await(let s of n6(e))for(let e of t.decode(s))yield e;for(let e of t.flush())yield e}return new ih(async function*(){if(r)throw new nN("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let e=!1;try{for await(let t of n())!e&&t&&(yield JSON.parse(t));e=!0}catch(e){if(nC(e))return;throw e}finally{e||t.abort()}},t,s)}[(eT=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){let e=[],t=[],s=this.iterator(),r=r=>({next:()=>{if(0===r.length){let r=s.next();e.push(r),t.push(r)}return r.shift()}});return[new ih(()=>r(e),this.controller,nT(this,eT,"f")),new ih(()=>r(t),this.controller,nT(this,eT,"f"))]}toReadableStream(){let e,t=this;return n4({async start(){e=t[Symbol.asyncIterator]()},async pull(t){try{let{value:s,done:r}=await e.next();if(r)return t.close();let n=n9(JSON.stringify(s)+"\n");t.enqueue(n)}catch(e){t.error(e)}},async cancel(){await e.return?.()}})}}async function*iu(e,t){if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new nN("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new nN("Attempted to iterate over a response with no body")}let s=new ip,r=new ie;for await(let t of id(n6(e.body)))for(let e of r.decode(t)){let t=s.decode(e);t&&(yield t)}for(let e of r.flush()){let t=s.decode(e);t&&(yield t)}}async function*id(e){let t=new Uint8Array;for await(let s of e){let e;if(null==s)continue;let r=s instanceof ArrayBuffer?new Uint8Array(s):"string"==typeof s?n9(s):s,n=new Uint8Array(t.length+r.length);for(n.set(t),n.set(r,t.length),t=n;-1!==(e=function(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1]||13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return -1}(t));)yield t.slice(0,e),t=t.slice(e)}t.length>0&&(yield t)}class ip{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){var t;let s;if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[r,n,i]=-1!==(s=(t=e).indexOf(":"))?[t.substring(0,s),":",t.substring(s+1)]:[t,"",""];return i.startsWith(" ")&&(i=i.substring(1)),"event"===r?this.event=i:"data"===r&&this.data.push(i),null}}async function im(e,t){let{response:s,requestLogID:r,retryOfRequestLogID:n,startTime:i}=t,a=await (async()=>{if(t.options.stream)return(il(e).debug("response",s.status,s.url,s.headers,s.body),t.options.__streamClass)?t.options.__streamClass.fromSSEResponse(s,t.controller):ih.fromSSEResponse(s,t.controller);if(204===s.status)return null;if(t.options.__binaryResponse)return s;let r=s.headers.get("content-type"),n=r?.split(";")[0]?.trim();return n?.includes("application/json")||n?.endsWith("+json")?ig(await s.json(),s):await s.text()})();return il(e).debug(`[${r}] response parsed`,ic({retryOfRequestLogID:n,url:s.url,status:s.status,body:a,durationMs:Date.now()-i})),a}function ig(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("request-id"),enumerable:!1})}class iy extends Promise{constructor(e,t,s=im){super(e=>{e(null)}),this.responsePromise=t,this.parseResponse=s,eM.set(this,void 0),nP(this,eM,e,"f")}_thenUnwrap(e){return new iy(nT(this,eM,"f"),this.responsePromise,async(t,s)=>ig(e(await this.parseResponse(t,s),s),s.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(nT(this,eM,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}eM=new WeakMap;class iw{constructor(e,t,s,r){eC.set(this,void 0),nP(this,eC,e,"f"),this.options=r,this.response=t,this.body=s}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageRequestOptions()}async getNextPage(){let e=this.nextPageRequestOptions();if(!e)throw new nN("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await nT(this,eC,"f").requestAPIList(this.constructor,e)}async *iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async *[(eC=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}}class i_ extends iy{constructor(e,t,s){super(e,t,async(e,t)=>new s(e,t.response,await im(e,t),t.options))}async *[Symbol.asyncIterator](){for await(let e of(await this))yield e}}class ib extends iw{constructor(e,t,s,r){super(e,t,s,r),this.data=s.data||[],this.has_more=s.has_more||!1,this.first_id=s.first_id||null,this.last_id=s.last_id||null}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){if(this.options.query?.before_id){let e=this.first_id;return e?{...this.options,query:{...nY(this.options.query),before_id:e}}:null}let e=this.last_id;return e?{...this.options,query:{...nY(this.options.query),after_id:e}}:null}}class iv extends iw{constructor(e,t,s,r){super(e,t,s,r),this.data=s.data||[],this.has_more=s.has_more||!1,this.next_page=s.next_page||null}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){let e=this.next_page;return e?{...this.options,query:{...nY(this.options.query),page:e}}:null}}let ix=()=>{if("undefined"==typeof File){let{process:e}=globalThis;throw Error("`File` is not defined as a global, which is required for file uploads."+("string"==typeof e?.versions?.node&&20>parseInt(e.versions.node.split("."))?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function iS(e,t,s){return ix(),new File(e,t??"unknown_file",s)}function ik(e){return("object"==typeof e&&null!==e&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}let iR=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],i$=async(e,t)=>({...e,body:await iO(e.body,t)}),iA=new WeakMap,iO=async(e,t)=>{if(!await function(e){let t="function"==typeof e?e:e.fetch,s=iA.get(t);if(s)return s;let r=(async()=>{try{let e="Response"in t?t.Response:(await t("data:,")).constructor,s=new FormData;if(s.toString()===await new e(s).text())return!1;return!0}catch{return!0}})();return iA.set(t,r),r}(t))throw TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let s=new FormData;return await Promise.all(Object.entries(e||{}).map(([e,t])=>iE(s,e,t))),s},iE=async(e,t,s)=>{if(void 0!==s){if(null==s)throw TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof s||"number"==typeof s||"boolean"==typeof s)e.append(t,String(s));else if(s instanceof Response){let r={},n=s.headers.get("Content-Type");n&&(r={type:n}),e.append(t,iS([await s.blob()],ik(s),r))}else if(iR(s))e.append(t,iS([await new Response(n5(s)).blob()],ik(s)));else{let r;if((r=s)instanceof Blob&&"name"in r)e.append(t,iS([s],ik(s),{type:s.type}));else if(Array.isArray(s))await Promise.all(s.map(s=>iE(e,t+"[]",s)));else if("object"==typeof s)await Promise.all(Object.entries(s).map(([s,r])=>iE(e,`${t}[${s}]`,r)));else throw TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${s} instead`)}}},iI=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer;async function iP(e,t,s){let r,n;if(ix(),e=await e,t||(t=ik(e)),null!=(r=e)&&"object"==typeof r&&"string"==typeof r.name&&"number"==typeof r.lastModified&&iI(r))return e instanceof File&&null==t&&null==s?e:iS([await e.arrayBuffer()],t??e.name,{type:e.type,lastModified:e.lastModified,...s});if(null!=(n=e)&&"object"==typeof n&&"string"==typeof n.url&&"function"==typeof n.blob){let r=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),iS(await iT(r),t,s)}let i=await iT(e);if(!s?.type){let e=i.find(e=>"object"==typeof e&&"type"in e&&e.type);"string"==typeof e&&(s={...s,type:e})}return iS(i,t,s)}async function iT(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(iI(e))t.push(e instanceof Blob?e:await e.arrayBuffer());else if(iR(e))for await(let s of e)t.push(...await iT(s));else{let t=e?.constructor?.name;throw Error(`Unexpected data type: ${typeof e}${t?`; constructor: ${t}`:""}${function(e){if("object"!=typeof e||null===e)return"";let t=Object.getOwnPropertyNames(e);return`; props: [${t.map(e=>`"${e}"`).join(", ")}]`}(e)}`)}return t}class iM{constructor(e){this._client=e}}let iC=Symbol.for("brand.privateNullableHeaders"),ij=e=>{let t=new Headers,s=new Set;for(let r of e){let e=new Set;for(let[n,i]of function*(e){let t;if(!e)return;if(iC in e){let{values:t,nulls:s}=e;for(let e of(yield*t.entries(),s))yield[e,null];return}let s=!1;for(let r of(e instanceof Headers?t=e.entries():nQ(e)?t=e:(s=!0,t=Object.entries(e??{})),t)){let e=r[0];if("string"!=typeof e)throw TypeError("expected header name to be a string");let t=nQ(r[1])?r[1]:[r[1]],n=!1;for(let r of t)void 0!==r&&(s&&!n&&(n=!0,yield[e,null]),yield[e,r])}}(r)){let r=n.toLowerCase();e.has(r)||(t.delete(n),e.add(r)),null===i?(t.delete(n),s.add(r)):(t.append(n,i),s.delete(r))}}return{[iC]:!0,values:t,nulls:s}};function iN(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}let iL=Object.freeze(Object.create(null)),iq=((e=iN)=>function(t,...s){let r;if(1===t.length)return t[0];let n=!1,i=[],a=t.reduce((t,r,a)=>{/[?#]/.test(r)&&(n=!0);let o=s[a],l=(n?encodeURIComponent:e)(""+o);return a!==s.length&&(null==o||"object"==typeof o&&o.toString===Object.getPrototypeOf(Object.getPrototypeOf(o.hasOwnProperty??iL)??iL)?.toString)&&(l=o+"",i.push({start:t.length+r.length,length:l.length,error:`Value of type ${Object.prototype.toString.call(o).slice(8,-1)} is not a valid path parameter`})),t+r+(a===s.length?"":l)},""),o=a.split(/[?#]/,1)[0],l=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;for(;null!==(r=l.exec(o));)i.push({start:r.index,length:r[0].length,error:`Value "${r[0]}" can't be safely passed as a path parameter`});if(i.sort((e,t)=>e.start-t.start),i.length>0){let e=0,t=i.reduce((t,s)=>{let r=" ".repeat(s.start-e),n="^".repeat(s.length);return e=s.start+s.length,t+r+n},"");throw new nN(`Path parameters result in path with invalid segments:
${i.map(e=>e.error).join("\n")}
${a}
${t}`)}return a})(iN);class iW extends iM{list(e={},t){let{betas:s,...r}=e??{};return this._client.getAPIList("/v1/files",ib,{query:r,...t,headers:ij([{"anthropic-beta":[...s??[],"files-api-2025-04-14"].toString()},t?.headers])})}delete(e,t={},s){let{betas:r}=t??{};return this._client.delete(iq`/v1/files/${e}`,{...s,headers:ij([{"anthropic-beta":[...r??[],"files-api-2025-04-14"].toString()},s?.headers])})}download(e,t={},s){let{betas:r}=t??{};return this._client.get(iq`/v1/files/${e}/content`,{...s,headers:ij([{"anthropic-beta":[...r??[],"files-api-2025-04-14"].toString(),Accept:"application/binary"},s?.headers]),__binaryResponse:!0})}retrieveMetadata(e,t={},s){let{betas:r}=t??{};return this._client.get(iq`/v1/files/${e}`,{...s,headers:ij([{"anthropic-beta":[...r??[],"files-api-2025-04-14"].toString()},s?.headers])})}upload(e,t){let{betas:s,...r}=e;return this._client.post("/v1/files",i$({body:r,...t,headers:ij([{"anthropic-beta":[...s??[],"files-api-2025-04-14"].toString()},t?.headers])},this._client))}}class iD extends iM{retrieve(e,t={},s){let{betas:r}=t??{};return this._client.get(iq`/v1/models/${e}?beta=true`,{...s,headers:ij([{...r?.toString()!=null?{"anthropic-beta":r?.toString()}:void 0},s?.headers])})}list(e={},t){let{betas:s,...r}=e??{};return this._client.getAPIList("/v1/models?beta=true",ib,{query:r,...t,headers:ij([{...s?.toString()!=null?{"anthropic-beta":s?.toString()}:void 0},t?.headers])})}}let iU={"claude-opus-4-20250514":8192,"claude-opus-4-0":8192,"claude-4-opus-20250514":8192,"anthropic.claude-opus-4-20250514-v1:0":8192,"claude-opus-4@20250514":8192,"claude-opus-4-1-20250805":8192,"anthropic.claude-opus-4-1-20250805-v1:0":8192,"claude-opus-4-1@20250805":8192};function iB(e,t,s){return t&&"parse"in(t.output_format??{})?iF(e,t,s):{...e,content:e.content.map(e=>"text"===e.type?Object.defineProperty(Object.defineProperty({...e},"parsed_output",{value:null,enumerable:!1}),"parsed",{get:()=>(s.logger.warn("The `parsed` property on `text` blocks is deprecated, please use `parsed_output` instead."),null),enumerable:!1}):e),parsed_output:null}}function iF(e,t,s){let r=null,n=e.content.map(e=>{if("text"===e.type){let n=function(e,t){if(e.output_format?.type!=="json_schema")return null;try{if("parse"in e.output_format)return e.output_format.parse(t);return JSON.parse(t)}catch(e){throw new nN(`Failed to parse structured output: ${e}`)}}(t,e.text);return null===r&&(r=n),Object.defineProperty(Object.defineProperty({...e},"parsed_output",{value:n,enumerable:!1}),"parsed",{get:()=>(s.logger.warn("The `parsed` property on `text` blocks is deprecated, please use `parsed_output` instead."),n),enumerable:!1})}return e});return{...e,content:n,parsed_output:r}}let iH=e=>{if(0===e.length)return e;let t=e[e.length-1];switch(t.type){case"separator":return iH(e=e.slice(0,e.length-1));case"number":let s=t.value[t.value.length-1];if("."===s||"-"===s)return iH(e=e.slice(0,e.length-1));case"string":let r=e[e.length-2];if(r?.type==="delimiter"||r?.type==="brace"&&"{"===r.value)return iH(e=e.slice(0,e.length-1));break;case"delimiter":return iH(e=e.slice(0,e.length-1))}return e},iX=e=>{var t;let s,r;return JSON.parse((t=iH((e=>{let t=0,s=[];for(;t<e.length;){let r=e[t];if("\\"===r){t++;continue}if("{"===r){s.push({type:"brace",value:"{"}),t++;continue}if("}"===r){s.push({type:"brace",value:"}"}),t++;continue}if("["===r){s.push({type:"paren",value:"["}),t++;continue}if("]"===r){s.push({type:"paren",value:"]"}),t++;continue}if(":"===r){s.push({type:"separator",value:":"}),t++;continue}if(","===r){s.push({type:"delimiter",value:","}),t++;continue}if('"'===r){let n="",i=!1;for(r=e[++t];'"'!==r;){if(t===e.length){i=!0;break}if("\\"===r){if(++t===e.length){i=!0;break}n+=r+e[t],r=e[++t]}else n+=r,r=e[++t]}r=e[++t],i||s.push({type:"string",value:n});continue}let n=/\s/;if(r&&n.test(r)){t++;continue}let i=/[0-9]/;if(r&&i.test(r)||"-"===r||"."===r){let n="";for("-"===r&&(n+=r,r=e[++t]);r&&i.test(r)||"."===r;)n+=r,r=e[++t];s.push({type:"number",value:n});continue}let a=/[a-z]/i;if(r&&a.test(r)){let n="";for(;r&&a.test(r)&&t!==e.length;)n+=r,r=e[++t];"true"==n||"false"==n||"null"===n?s.push({type:"name",value:n}):t++;continue}t++}return s})(e)),s=[],t.map(e=>{"brace"===e.type&&("{"===e.value?s.push("}"):s.splice(s.lastIndexOf("}"),1)),"paren"===e.type&&("["===e.value?s.push("]"):s.splice(s.lastIndexOf("]"),1))}),s.length>0&&s.reverse().map(e=>{"}"===e?t.push({type:"brace",value:"}"}):"]"===e&&t.push({type:"paren",value:"]"})}),r="",t.map(e=>{"string"===e.type?r+='"'+e.value+'"':r+=e.value}),r))},iJ="__json_buf";function iK(e){return"tool_use"===e.type||"server_tool_use"===e.type||"mcp_tool_use"===e.type}class iV{constructor(e,t){ej.add(this),this.messages=[],this.receivedMessages=[],eN.set(this,void 0),eL.set(this,null),this.controller=new AbortController,eq.set(this,void 0),eW.set(this,()=>{}),eD.set(this,()=>{}),eU.set(this,void 0),eB.set(this,()=>{}),eF.set(this,()=>{}),eH.set(this,{}),eX.set(this,!1),eJ.set(this,!1),eK.set(this,!1),eV.set(this,!1),ez.set(this,void 0),eG.set(this,void 0),eQ.set(this,void 0),e0.set(this,e=>{if(nP(this,eJ,!0,"f"),nC(e)&&(e=new nq),e instanceof nq)return nP(this,eK,!0,"f"),this._emit("abort",e);if(e instanceof nN)return this._emit("error",e);if(e instanceof Error){let t=new nN(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new nN(String(e)))}),nP(this,eq,new Promise((e,t)=>{nP(this,eW,e,"f"),nP(this,eD,t,"f")}),"f"),nP(this,eU,new Promise((e,t)=>{nP(this,eB,e,"f"),nP(this,eF,t,"f")}),"f"),nT(this,eq,"f").catch(()=>{}),nT(this,eU,"f").catch(()=>{}),nP(this,eL,e,"f"),nP(this,eQ,t?.logger??console,"f")}get response(){return nT(this,ez,"f")}get request_id(){return nT(this,eG,"f")}async withResponse(){nP(this,eV,!0,"f");let e=await nT(this,eq,"f");if(!e)throw Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){let t=new iV(null);return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,s,{logger:r}={}){let n=new iV(t,{logger:r});for(let e of t.messages)n._addMessageParam(e);return nP(n,eL,{...t,stream:!0},"f"),n._run(()=>n._createMessage(e,{...t,stream:!0},{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),n}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},nT(this,e0,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,s){let r,n=s?.signal;n&&(n.aborted&&this.controller.abort(),r=this.controller.abort.bind(this.controller),n.addEventListener("abort",r));try{nT(this,ej,"m",e1).call(this);let{response:r,data:n}=await e.create({...t,stream:!0},{...s,signal:this.controller.signal}).withResponse();for await(let e of(this._connected(r),n))nT(this,ej,"m",e2).call(this,e);if(n.controller.signal?.aborted)throw new nq;nT(this,ej,"m",e4).call(this)}finally{n&&r&&n.removeEventListener("abort",r)}}_connected(e){this.ended||(nP(this,ez,e,"f"),nP(this,eG,e?.headers.get("request-id"),"f"),nT(this,eW,"f").call(this,e),this._emit("connect"))}get ended(){return nT(this,eX,"f")}get errored(){return nT(this,eJ,"f")}get aborted(){return nT(this,eK,"f")}abort(){this.controller.abort()}on(e,t){return(nT(this,eH,"f")[e]||(nT(this,eH,"f")[e]=[])).push({listener:t}),this}off(e,t){let s=nT(this,eH,"f")[e];if(!s)return this;let r=s.findIndex(e=>e.listener===t);return r>=0&&s.splice(r,1),this}once(e,t){return(nT(this,eH,"f")[e]||(nT(this,eH,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,s)=>{nP(this,eV,!0,"f"),"error"!==e&&this.once("error",s),this.once(e,t)})}async done(){nP(this,eV,!0,"f"),await nT(this,eU,"f")}get currentMessage(){return nT(this,eN,"f")}async finalMessage(){return await this.done(),nT(this,ej,"m",eY).call(this)}async finalText(){return await this.done(),nT(this,ej,"m",eZ).call(this)}_emit(e,...t){if(nT(this,eX,"f"))return;"end"===e&&(nP(this,eX,!0,"f"),nT(this,eB,"f").call(this));let s=nT(this,eH,"f")[e];if(s&&(nT(this,eH,"f")[e]=s.filter(e=>!e.once),s.forEach(({listener:e})=>e(...t))),"abort"===e){let e=t[0];nT(this,eV,"f")||s?.length||Promise.reject(e),nT(this,eD,"f").call(this,e),nT(this,eF,"f").call(this,e),this._emit("end");return}if("error"===e){let e=t[0];nT(this,eV,"f")||s?.length||Promise.reject(e),nT(this,eD,"f").call(this,e),nT(this,eF,"f").call(this,e),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",nT(this,ej,"m",eY).call(this))}async _fromReadableStream(e,t){let s,r=t?.signal;r&&(r.aborted&&this.controller.abort(),s=this.controller.abort.bind(this.controller),r.addEventListener("abort",s));try{nT(this,ej,"m",e1).call(this),this._connected(null);let t=ih.fromReadableStream(e,this.controller);for await(let e of t)nT(this,ej,"m",e2).call(this,e);if(t.controller.signal?.aborted)throw new nq;nT(this,ej,"m",e4).call(this)}finally{r&&s&&r.removeEventListener("abort",s)}}[(eN=new WeakMap,eL=new WeakMap,eq=new WeakMap,eW=new WeakMap,eD=new WeakMap,eU=new WeakMap,eB=new WeakMap,eF=new WeakMap,eH=new WeakMap,eX=new WeakMap,eJ=new WeakMap,eK=new WeakMap,eV=new WeakMap,ez=new WeakMap,eG=new WeakMap,eQ=new WeakMap,e0=new WeakMap,ej=new WeakSet,eY=function(){if(0===this.receivedMessages.length)throw new nN("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},eZ=function(){if(0===this.receivedMessages.length)throw new nN("stream ended without producing a Message with role=assistant");let e=this.receivedMessages.at(-1).content.filter(e=>"text"===e.type).map(e=>e.text);if(0===e.length)throw new nN("stream ended without producing a content block with type=text");return e.join(" ")},e1=function(){this.ended||nP(this,eN,void 0,"f")},e2=function(e){if(this.ended)return;let t=nT(this,ej,"m",e5).call(this,e);switch(this._emit("streamEvent",e,t),e.type){case"content_block_delta":{let s=t.content.at(-1);switch(e.delta.type){case"text_delta":"text"===s.type&&this._emit("text",e.delta.text,s.text||"");break;case"citations_delta":"text"===s.type&&this._emit("citation",e.delta.citation,s.citations??[]);break;case"input_json_delta":iK(s)&&s.input&&this._emit("inputJson",e.delta.partial_json,s.input);break;case"thinking_delta":"thinking"===s.type&&this._emit("thinking",e.delta.thinking,s.thinking);break;case"signature_delta":"thinking"===s.type&&this._emit("signature",s.signature);break;default:iz(e.delta)}break}case"message_stop":this._addMessageParam(t),this._addMessage(iB(t,nT(this,eL,"f"),{logger:nT(this,eQ,"f")}),!0);break;case"content_block_stop":this._emit("contentBlock",t.content.at(-1));break;case"message_start":nP(this,eN,t,"f")}},e4=function(){if(this.ended)throw new nN("stream has ended, this shouldn't happen");let e=nT(this,eN,"f");if(!e)throw new nN("request ended without sending any chunks");return nP(this,eN,void 0,"f"),iB(e,nT(this,eL,"f"),{logger:nT(this,eQ,"f")})},e5=function(e){let t=nT(this,eN,"f");if("message_start"===e.type){if(t)throw new nN(`Unexpected event order, got ${e.type} before receiving "message_stop"`);return e.message}if(!t)throw new nN(`Unexpected event order, got ${e.type} before "message_start"`);switch(e.type){case"message_stop":case"content_block_stop":return t;case"message_delta":return t.container=e.delta.container,t.stop_reason=e.delta.stop_reason,t.stop_sequence=e.delta.stop_sequence,t.usage.output_tokens=e.usage.output_tokens,t.context_management=e.context_management,null!=e.usage.input_tokens&&(t.usage.input_tokens=e.usage.input_tokens),null!=e.usage.cache_creation_input_tokens&&(t.usage.cache_creation_input_tokens=e.usage.cache_creation_input_tokens),null!=e.usage.cache_read_input_tokens&&(t.usage.cache_read_input_tokens=e.usage.cache_read_input_tokens),null!=e.usage.server_tool_use&&(t.usage.server_tool_use=e.usage.server_tool_use),t;case"content_block_start":return t.content.push(e.content_block),t;case"content_block_delta":{let s=t.content.at(e.index);switch(e.delta.type){case"text_delta":s?.type==="text"&&(t.content[e.index]={...s,text:(s.text||"")+e.delta.text});break;case"citations_delta":s?.type==="text"&&(t.content[e.index]={...s,citations:[...s.citations??[],e.delta.citation]});break;case"input_json_delta":if(s&&iK(s)){let r=s[iJ]||"";r+=e.delta.partial_json;let n={...s};if(Object.defineProperty(n,iJ,{value:r,enumerable:!1,writable:!0}),r)try{n.input=iX(r)}catch(t){let e=new nN(`Unable to parse tool parameter JSON from model. Please retry your request or adjust your prompt. Error: ${t}. JSON: ${r}`);nT(this,e0,"f").call(this,e)}t.content[e.index]=n}break;case"thinking_delta":s?.type==="thinking"&&(t.content[e.index]={...s,thinking:s.thinking+e.delta.thinking});break;case"signature_delta":s?.type==="thinking"&&(t.content[e.index]={...s,signature:e.delta.signature});break;default:iz(e.delta)}return t}}},Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("streamEvent",s=>{let r=t.shift();r?r.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),this.on("error",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new ih(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function iz(e){}let iG=`You have been working on the task described above but have not yet completed it. Write a continuation summary that will allow you (or another instance of yourself) to resume work efficiently in a future context window where the conversation history will be replaced with this summary. Your summary should be structured, concise, and actionable. Include:
1. Task Overview
The user's core request and success criteria
Any clarifications or constraints they specified
2. Current State
What has been completed so far
Files created, modified, or analyzed (with paths if relevant)
Key outputs or artifacts produced
3. Important Discoveries
Technical constraints or requirements uncovered
Decisions made and their rationale
Errors encountered and how they were resolved
What approaches were tried that didn't work (and why)
4. Next Steps
Specific actions needed to complete the task
Any blockers or open questions to resolve
Priority order if multiple steps remain
5. Context to Preserve
User preferences or style requirements
Domain-specific details that aren't obvious
Any promises made to the user
Be concise but completeerr on the side of including information that would prevent duplicate work or repeated mistakes. Write in a way that enables immediate resumption of the task.
Wrap your summary in <summary></summary> tags.`;function iQ(){let e,t;return{promise:new Promise((s,r)=>{e=s,t=r}),resolve:e,reject:t}}class iY{constructor(e,t,s){e6.add(this),this.client=e,e3.set(this,!1),e8.set(this,!1),e9.set(this,void 0),e7.set(this,void 0),te.set(this,void 0),tt.set(this,void 0),ts.set(this,void 0),tr.set(this,0),nP(this,e9,{params:{...t,messages:structuredClone(t.messages)}},"f"),nP(this,e7,{...s,headers:ij([{"x-stainless-helper":"BetaToolRunner"},s?.headers])},"f"),nP(this,ts,iQ(),"f")}async *[(e3=new WeakMap,e8=new WeakMap,e9=new WeakMap,e7=new WeakMap,te=new WeakMap,tt=new WeakMap,ts=new WeakMap,tr=new WeakMap,e6=new WeakSet,tn=async function(){let e=nT(this,e9,"f").params.compactionControl;if(!e||!e.enabled)return!1;let t=0;if(void 0!==nT(this,te,"f"))try{let e=await nT(this,te,"f");t=e.usage.input_tokens+(e.usage.cache_creation_input_tokens??0)+(e.usage.cache_read_input_tokens??0)+e.usage.output_tokens}catch{return!1}if(t<(e.contextTokenThreshold??1e5))return!1;let s=e.model??nT(this,e9,"f").params.model,r=e.summaryPrompt??iG,n=nT(this,e9,"f").params.messages;if("assistant"===n[n.length-1].role){let e=n[n.length-1];if(Array.isArray(e.content)){let t=e.content.filter(e=>"tool_use"!==e.type);0===t.length?n.pop():e.content=t}}let i=await this.client.beta.messages.create({model:s,messages:[...n,{role:"user",content:[{type:"text",text:r}]}],max_tokens:nT(this,e9,"f").params.max_tokens},{headers:{"x-stainless-helper":"compaction"}});if(i.content[0]?.type!=="text")throw new nN("Expected text response for compaction");return nT(this,e9,"f").params.messages=[{role:"user",content:i.content}],!0},Symbol.asyncIterator)](){var e;if(nT(this,e3,"f"))throw new nN("Cannot iterate over a consumed stream");nP(this,e3,!0,"f"),nP(this,e8,!0,"f"),nP(this,tt,void 0,"f");try{for(;;){let t;try{if(nT(this,e9,"f").params.max_iterations&&nT(this,tr,"f")>=nT(this,e9,"f").params.max_iterations)break;nP(this,e8,!1,"f"),nP(this,tt,void 0,"f"),nP(this,tr,(e=nT(this,tr,"f"),++e),"f"),nP(this,te,void 0,"f");let{max_iterations:s,compactionControl:r,...n}=nT(this,e9,"f").params;if(n.stream?(t=this.client.beta.messages.stream({...n},nT(this,e7,"f")),nP(this,te,t.finalMessage(),"f"),nT(this,te,"f").catch(()=>{}),yield t):(nP(this,te,this.client.beta.messages.create({...n,stream:!1},nT(this,e7,"f")),"f"),yield nT(this,te,"f")),!await nT(this,e6,"m",tn).call(this)){if(!nT(this,e8,"f")){let{role:e,content:t}=await nT(this,te,"f");nT(this,e9,"f").params.messages.push({role:e,content:t})}let e=await nT(this,e6,"m",ti).call(this,nT(this,e9,"f").params.messages.at(-1));if(e)nT(this,e9,"f").params.messages.push(e);else if(!nT(this,e8,"f"))break}}finally{t&&t.abort()}}if(!nT(this,te,"f"))throw new nN("ToolRunner concluded without a message from the server");nT(this,ts,"f").resolve(await nT(this,te,"f"))}catch(e){throw nP(this,e3,!1,"f"),nT(this,ts,"f").promise.catch(()=>{}),nT(this,ts,"f").reject(e),nP(this,ts,iQ(),"f"),e}}setMessagesParams(e){"function"==typeof e?nT(this,e9,"f").params=e(nT(this,e9,"f").params):nT(this,e9,"f").params=e,nP(this,e8,!0,"f"),nP(this,tt,void 0,"f")}async generateToolResponse(){let e=await nT(this,te,"f")??this.params.messages.at(-1);return e?nT(this,e6,"m",ti).call(this,e):null}done(){return nT(this,ts,"f").promise}async runUntilDone(){if(!nT(this,e3,"f"))for await(let e of this);return this.done()}get params(){return nT(this,e9,"f").params}pushMessages(...e){this.setMessagesParams(t=>({...t,messages:[...t.messages,...e]}))}then(e,t){return this.runUntilDone().then(e,t)}}async function iZ(e,t=e.messages.at(-1)){if(!t||"assistant"!==t.role||!t.content||"string"==typeof t.content)return null;let s=t.content.filter(e=>"tool_use"===e.type);return 0===s.length?null:{role:"user",content:await Promise.all(s.map(async t=>{let s=e.tools.find(e=>("name"in e?e.name:e.mcp_server_name)===t.name);if(!s||!("run"in s))return{type:"tool_result",tool_use_id:t.id,content:`Error: Tool '${t.name}' not found`,is_error:!0};try{let e=t.input;"parse"in s&&s.parse&&(e=s.parse(e));let r=await s.run(e);return{type:"tool_result",tool_use_id:t.id,content:r}}catch(e){return{type:"tool_result",tool_use_id:t.id,content:`Error: ${e instanceof Error?e.message:String(e)}`,is_error:!0}}}))}}ti=async function(e){return void 0!==nT(this,tt,"f")||nP(this,tt,iZ(nT(this,e9,"f").params,e),"f"),nT(this,tt,"f")};class i0{constructor(e,t){this.iterator=e,this.controller=t}async *decoder(){let e=new ie;for await(let t of this.iterator)for(let s of e.decode(t))yield JSON.parse(s);for(let t of e.flush())yield JSON.parse(t)}[Symbol.asyncIterator](){return this.decoder()}static fromResponse(e,t){if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new nN("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new nN("Attempted to iterate over a response with no body")}return new i0(n6(e.body),t)}}class i1 extends iM{create(e,t){let{betas:s,...r}=e;return this._client.post("/v1/messages/batches?beta=true",{body:r,...t,headers:ij([{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString()},t?.headers])})}retrieve(e,t={},s){let{betas:r}=t??{};return this._client.get(iq`/v1/messages/batches/${e}?beta=true`,{...s,headers:ij([{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString()},s?.headers])})}list(e={},t){let{betas:s,...r}=e??{};return this._client.getAPIList("/v1/messages/batches?beta=true",ib,{query:r,...t,headers:ij([{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString()},t?.headers])})}delete(e,t={},s){let{betas:r}=t??{};return this._client.delete(iq`/v1/messages/batches/${e}?beta=true`,{...s,headers:ij([{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString()},s?.headers])})}cancel(e,t={},s){let{betas:r}=t??{};return this._client.post(iq`/v1/messages/batches/${e}/cancel?beta=true`,{...s,headers:ij([{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString()},s?.headers])})}async results(e,t={},s){let r=await this.retrieve(e);if(!r.results_url)throw new nN(`No batch \`results_url\`; Has it finished processing? ${r.processing_status} - ${r.id}`);let{betas:n}=t??{};return this._client.get(r.results_url,{...s,headers:ij([{"anthropic-beta":[...n??[],"message-batches-2024-09-24"].toString(),Accept:"application/binary"},s?.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap((e,t)=>i0.fromResponse(t.response,t.controller))}}let i2={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-3-opus-20240229":"January 5th, 2026","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025","claude-3-7-sonnet-latest":"February 19th, 2026","claude-3-7-sonnet-20250219":"February 19th, 2026"};class i4 extends iM{constructor(){super(...arguments),this.batches=new i1(this._client)}create(e,t){let{betas:s,...r}=e;r.model in i2&&console.warn(`The model '${r.model}' is deprecated and will reach end-of-life on ${i2[r.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`);let n=this._client._options.timeout;if(!r.stream&&null==n){let e=iU[r.model]??void 0;n=this._client.calculateNonstreamingTimeout(r.max_tokens,e)}return this._client.post("/v1/messages?beta=true",{body:r,timeout:n??6e5,...t,headers:ij([{...s?.toString()!=null?{"anthropic-beta":s?.toString()}:void 0},t?.headers]),stream:e.stream??!1})}parse(e,t){return t={...t,headers:ij([{"anthropic-beta":[...e.betas??[],"structured-outputs-2025-11-13"].toString()},t?.headers])},this.create(e,t).then(t=>iF(t,e,{logger:this._client.logger??console}))}stream(e,t){return iV.createMessage(this,e,t)}countTokens(e,t){let{betas:s,...r}=e;return this._client.post("/v1/messages/count_tokens?beta=true",{body:r,...t,headers:ij([{"anthropic-beta":[...s??[],"token-counting-2024-11-01"].toString()},t?.headers])})}toolRunner(e,t){return new iY(this._client,e,t)}}i4.Batches=i1,i4.BetaToolRunner=iY;class i5 extends iM{create(e,t={},s){let{betas:r,...n}=t??{};return this._client.post(iq`/v1/skills/${e}/versions?beta=true`,i$({body:n,...s,headers:ij([{"anthropic-beta":[...r??[],"skills-2025-10-02"].toString()},s?.headers])},this._client))}retrieve(e,t,s){let{skill_id:r,betas:n}=t;return this._client.get(iq`/v1/skills/${r}/versions/${e}?beta=true`,{...s,headers:ij([{"anthropic-beta":[...n??[],"skills-2025-10-02"].toString()},s?.headers])})}list(e,t={},s){let{betas:r,...n}=t??{};return this._client.getAPIList(iq`/v1/skills/${e}/versions?beta=true`,iv,{query:n,...s,headers:ij([{"anthropic-beta":[...r??[],"skills-2025-10-02"].toString()},s?.headers])})}delete(e,t,s){let{skill_id:r,betas:n}=t;return this._client.delete(iq`/v1/skills/${r}/versions/${e}?beta=true`,{...s,headers:ij([{"anthropic-beta":[...n??[],"skills-2025-10-02"].toString()},s?.headers])})}}class i6 extends iM{constructor(){super(...arguments),this.versions=new i5(this._client)}create(e={},t){let{betas:s,...r}=e??{};return this._client.post("/v1/skills?beta=true",i$({body:r,...t,headers:ij([{"anthropic-beta":[...s??[],"skills-2025-10-02"].toString()},t?.headers])},this._client))}retrieve(e,t={},s){let{betas:r}=t??{};return this._client.get(iq`/v1/skills/${e}?beta=true`,{...s,headers:ij([{"anthropic-beta":[...r??[],"skills-2025-10-02"].toString()},s?.headers])})}list(e={},t){let{betas:s,...r}=e??{};return this._client.getAPIList("/v1/skills?beta=true",iv,{query:r,...t,headers:ij([{"anthropic-beta":[...s??[],"skills-2025-10-02"].toString()},t?.headers])})}delete(e,t={},s){let{betas:r}=t??{};return this._client.delete(iq`/v1/skills/${e}?beta=true`,{...s,headers:ij([{"anthropic-beta":[...r??[],"skills-2025-10-02"].toString()},s?.headers])})}}i6.Versions=i5;class i3 extends iM{constructor(){super(...arguments),this.models=new iD(this._client),this.messages=new i4(this._client),this.files=new iW(this._client),this.skills=new i6(this._client)}}i3.Models=iD,i3.Messages=i4,i3.Files=iW,i3.Skills=i6;class i8 extends iM{create(e,t){let{betas:s,...r}=e;return this._client.post("/v1/complete",{body:r,timeout:this._client._options.timeout??6e5,...t,headers:ij([{...s?.toString()!=null?{"anthropic-beta":s?.toString()}:void 0},t?.headers]),stream:e.stream??!1})}}let i9="__json_buf";function i7(e){return"tool_use"===e.type||"server_tool_use"===e.type}class ae{constructor(){ta.add(this),this.messages=[],this.receivedMessages=[],to.set(this,void 0),this.controller=new AbortController,tl.set(this,void 0),tc.set(this,()=>{}),th.set(this,()=>{}),tu.set(this,void 0),td.set(this,()=>{}),tp.set(this,()=>{}),tf.set(this,{}),tm.set(this,!1),tg.set(this,!1),ty.set(this,!1),tw.set(this,!1),t_.set(this,void 0),tb.set(this,void 0),tS.set(this,e=>{if(nP(this,tg,!0,"f"),nC(e)&&(e=new nq),e instanceof nq)return nP(this,ty,!0,"f"),this._emit("abort",e);if(e instanceof nN)return this._emit("error",e);if(e instanceof Error){let t=new nN(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new nN(String(e)))}),nP(this,tl,new Promise((e,t)=>{nP(this,tc,e,"f"),nP(this,th,t,"f")}),"f"),nP(this,tu,new Promise((e,t)=>{nP(this,td,e,"f"),nP(this,tp,t,"f")}),"f"),nT(this,tl,"f").catch(()=>{}),nT(this,tu,"f").catch(()=>{})}get response(){return nT(this,t_,"f")}get request_id(){return nT(this,tb,"f")}async withResponse(){nP(this,tw,!0,"f");let e=await nT(this,tl,"f");if(!e)throw Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){let t=new ae;return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,s){let r=new ae;for(let e of t.messages)r._addMessageParam(e);return r._run(()=>r._createMessage(e,{...t,stream:!0},{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),r}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},nT(this,tS,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,s){let r,n=s?.signal;n&&(n.aborted&&this.controller.abort(),r=this.controller.abort.bind(this.controller),n.addEventListener("abort",r));try{nT(this,ta,"m",tk).call(this);let{response:r,data:n}=await e.create({...t,stream:!0},{...s,signal:this.controller.signal}).withResponse();for await(let e of(this._connected(r),n))nT(this,ta,"m",tR).call(this,e);if(n.controller.signal?.aborted)throw new nq;nT(this,ta,"m",t$).call(this)}finally{n&&r&&n.removeEventListener("abort",r)}}_connected(e){this.ended||(nP(this,t_,e,"f"),nP(this,tb,e?.headers.get("request-id"),"f"),nT(this,tc,"f").call(this,e),this._emit("connect"))}get ended(){return nT(this,tm,"f")}get errored(){return nT(this,tg,"f")}get aborted(){return nT(this,ty,"f")}abort(){this.controller.abort()}on(e,t){return(nT(this,tf,"f")[e]||(nT(this,tf,"f")[e]=[])).push({listener:t}),this}off(e,t){let s=nT(this,tf,"f")[e];if(!s)return this;let r=s.findIndex(e=>e.listener===t);return r>=0&&s.splice(r,1),this}once(e,t){return(nT(this,tf,"f")[e]||(nT(this,tf,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,s)=>{nP(this,tw,!0,"f"),"error"!==e&&this.once("error",s),this.once(e,t)})}async done(){nP(this,tw,!0,"f"),await nT(this,tu,"f")}get currentMessage(){return nT(this,to,"f")}async finalMessage(){return await this.done(),nT(this,ta,"m",tv).call(this)}async finalText(){return await this.done(),nT(this,ta,"m",tx).call(this)}_emit(e,...t){if(nT(this,tm,"f"))return;"end"===e&&(nP(this,tm,!0,"f"),nT(this,td,"f").call(this));let s=nT(this,tf,"f")[e];if(s&&(nT(this,tf,"f")[e]=s.filter(e=>!e.once),s.forEach(({listener:e})=>e(...t))),"abort"===e){let e=t[0];nT(this,tw,"f")||s?.length||Promise.reject(e),nT(this,th,"f").call(this,e),nT(this,tp,"f").call(this,e),this._emit("end");return}if("error"===e){let e=t[0];nT(this,tw,"f")||s?.length||Promise.reject(e),nT(this,th,"f").call(this,e),nT(this,tp,"f").call(this,e),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",nT(this,ta,"m",tv).call(this))}async _fromReadableStream(e,t){let s,r=t?.signal;r&&(r.aborted&&this.controller.abort(),s=this.controller.abort.bind(this.controller),r.addEventListener("abort",s));try{nT(this,ta,"m",tk).call(this),this._connected(null);let t=ih.fromReadableStream(e,this.controller);for await(let e of t)nT(this,ta,"m",tR).call(this,e);if(t.controller.signal?.aborted)throw new nq;nT(this,ta,"m",t$).call(this)}finally{r&&s&&r.removeEventListener("abort",s)}}[(to=new WeakMap,tl=new WeakMap,tc=new WeakMap,th=new WeakMap,tu=new WeakMap,td=new WeakMap,tp=new WeakMap,tf=new WeakMap,tm=new WeakMap,tg=new WeakMap,ty=new WeakMap,tw=new WeakMap,t_=new WeakMap,tb=new WeakMap,tS=new WeakMap,ta=new WeakSet,tv=function(){if(0===this.receivedMessages.length)throw new nN("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},tx=function(){if(0===this.receivedMessages.length)throw new nN("stream ended without producing a Message with role=assistant");let e=this.receivedMessages.at(-1).content.filter(e=>"text"===e.type).map(e=>e.text);if(0===e.length)throw new nN("stream ended without producing a content block with type=text");return e.join(" ")},tk=function(){this.ended||nP(this,to,void 0,"f")},tR=function(e){if(this.ended)return;let t=nT(this,ta,"m",tA).call(this,e);switch(this._emit("streamEvent",e,t),e.type){case"content_block_delta":{let s=t.content.at(-1);switch(e.delta.type){case"text_delta":"text"===s.type&&this._emit("text",e.delta.text,s.text||"");break;case"citations_delta":"text"===s.type&&this._emit("citation",e.delta.citation,s.citations??[]);break;case"input_json_delta":i7(s)&&s.input&&this._emit("inputJson",e.delta.partial_json,s.input);break;case"thinking_delta":"thinking"===s.type&&this._emit("thinking",e.delta.thinking,s.thinking);break;case"signature_delta":"thinking"===s.type&&this._emit("signature",s.signature);break;default:at(e.delta)}break}case"message_stop":this._addMessageParam(t),this._addMessage(t,!0);break;case"content_block_stop":this._emit("contentBlock",t.content.at(-1));break;case"message_start":nP(this,to,t,"f")}},t$=function(){if(this.ended)throw new nN("stream has ended, this shouldn't happen");let e=nT(this,to,"f");if(!e)throw new nN("request ended without sending any chunks");return nP(this,to,void 0,"f"),e},tA=function(e){let t=nT(this,to,"f");if("message_start"===e.type){if(t)throw new nN(`Unexpected event order, got ${e.type} before receiving "message_stop"`);return e.message}if(!t)throw new nN(`Unexpected event order, got ${e.type} before "message_start"`);switch(e.type){case"message_stop":case"content_block_stop":return t;case"message_delta":return t.stop_reason=e.delta.stop_reason,t.stop_sequence=e.delta.stop_sequence,t.usage.output_tokens=e.usage.output_tokens,null!=e.usage.input_tokens&&(t.usage.input_tokens=e.usage.input_tokens),null!=e.usage.cache_creation_input_tokens&&(t.usage.cache_creation_input_tokens=e.usage.cache_creation_input_tokens),null!=e.usage.cache_read_input_tokens&&(t.usage.cache_read_input_tokens=e.usage.cache_read_input_tokens),null!=e.usage.server_tool_use&&(t.usage.server_tool_use=e.usage.server_tool_use),t;case"content_block_start":return t.content.push({...e.content_block}),t;case"content_block_delta":{let s=t.content.at(e.index);switch(e.delta.type){case"text_delta":s?.type==="text"&&(t.content[e.index]={...s,text:(s.text||"")+e.delta.text});break;case"citations_delta":s?.type==="text"&&(t.content[e.index]={...s,citations:[...s.citations??[],e.delta.citation]});break;case"input_json_delta":if(s&&i7(s)){let r=s[i9]||"";r+=e.delta.partial_json;let n={...s};Object.defineProperty(n,i9,{value:r,enumerable:!1,writable:!0}),r&&(n.input=iX(r)),t.content[e.index]=n}break;case"thinking_delta":s?.type==="thinking"&&(t.content[e.index]={...s,thinking:s.thinking+e.delta.thinking});break;case"signature_delta":s?.type==="thinking"&&(t.content[e.index]={...s,signature:e.delta.signature});break;default:at(e.delta)}return t}}},Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("streamEvent",s=>{let r=t.shift();r?r.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),this.on("error",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new ih(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function at(e){}class as extends iM{create(e,t){return this._client.post("/v1/messages/batches",{body:e,...t})}retrieve(e,t){return this._client.get(iq`/v1/messages/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/v1/messages/batches",ib,{query:e,...t})}delete(e,t){return this._client.delete(iq`/v1/messages/batches/${e}`,t)}cancel(e,t){return this._client.post(iq`/v1/messages/batches/${e}/cancel`,t)}async results(e,t){let s=await this.retrieve(e);if(!s.results_url)throw new nN(`No batch \`results_url\`; Has it finished processing? ${s.processing_status} - ${s.id}`);return this._client.get(s.results_url,{...t,headers:ij([{Accept:"application/binary"},t?.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap((e,t)=>i0.fromResponse(t.response,t.controller))}}class ar extends iM{constructor(){super(...arguments),this.batches=new as(this._client)}create(e,t){e.model in an&&console.warn(`The model '${e.model}' is deprecated and will reach end-of-life on ${an[e.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`);let s=this._client._options.timeout;if(!e.stream&&null==s){let t=iU[e.model]??void 0;s=this._client.calculateNonstreamingTimeout(e.max_tokens,t)}return this._client.post("/v1/messages",{body:e,timeout:s??6e5,...t,stream:e.stream??!1})}stream(e,t){return ae.createMessage(this,e,t)}countTokens(e,t){return this._client.post("/v1/messages/count_tokens",{body:e,...t})}}let an={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-3-opus-20240229":"January 5th, 2026","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025","claude-3-7-sonnet-latest":"February 19th, 2026","claude-3-7-sonnet-20250219":"February 19th, 2026"};ar.Batches=as;class ai extends iM{retrieve(e,t={},s){let{betas:r}=t??{};return this._client.get(iq`/v1/models/${e}`,{...s,headers:ij([{...r?.toString()!=null?{"anthropic-beta":r?.toString()}:void 0},s?.headers])})}list(e={},t){let{betas:s,...r}=e??{};return this._client.getAPIList("/v1/models",ib,{query:r,...t,headers:ij([{...s?.toString()!=null?{"anthropic-beta":s?.toString()}:void 0},t?.headers])})}}let aa=e=>void 0!==globalThis.process?globalThis.process.env?.[e]?.trim()??void 0:void 0!==globalThis.Deno?globalThis.Deno.env?.get?.(e)?.trim():void 0;class ao{constructor({baseURL:e=aa("ANTHROPIC_BASE_URL"),apiKey:t=aa("ANTHROPIC_API_KEY")??null,authToken:s=aa("ANTHROPIC_AUTH_TOKEN")??null,...r}={}){tO.add(this),tI.set(this,void 0);const n={apiKey:t,authToken:s,...r,baseURL:e||"https://api.anthropic.com"};n.dangerouslyAllowBrowser,this.baseURL=n.baseURL,this.timeout=n.timeout??tE.DEFAULT_TIMEOUT,this.logger=n.logger??console;const i="warn";this.logLevel=i,this.logLevel=is(n.logLevel,"ClientOptions.logLevel",this)??is(aa("ANTHROPIC_LOG"),"process.env['ANTHROPIC_LOG']",this)??i,this.fetchOptions=n.fetchOptions,this.maxRetries=n.maxRetries??2,this.fetch=n.fetch??function(){if("undefined"!=typeof fetch)return fetch;throw Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new Anthropic({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),nP(this,tI,n8,"f"),this._options=n,this.apiKey="string"==typeof t?t:null,this.authToken=s}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,authToken:this.authToken,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){if(!(e.get("x-api-key")||e.get("authorization")||this.apiKey&&e.get("x-api-key")||t.has("x-api-key")||this.authToken&&e.get("authorization"))&&!t.has("authorization"))throw Error('Could not resolve authentication method. Expected either apiKey or authToken to be set. Or for one of the "X-Api-Key" or "Authorization" headers to be explicitly omitted')}async authHeaders(e){return ij([await this.apiKeyAuth(e),await this.bearerAuth(e)])}async apiKeyAuth(e){if(null!=this.apiKey)return ij([{"X-Api-Key":this.apiKey}])}async bearerAuth(e){if(null!=this.authToken)return ij([{Authorization:`Bearer ${this.authToken}`}])}stringifyQuery(e){return Object.entries(e).filter(([e,t])=>void 0!==t).map(([e,t])=>{if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;if(null===t)return`${encodeURIComponent(e)}=`;throw new nN(`Cannot stringify type ${typeof t}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${n0}`}defaultIdempotencyKey(){return`stainless-node-retry-${nM()}`}makeStatusError(e,t,s,r){return nL.generate(e,t,s,r)}buildURL(e,t,s){let r=!nT(this,tO,"m",tP).call(this)&&s||this.baseURL,n=new URL(nz.test(e)?e:r+(r.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),i=this.defaultQuery();return!function(e){if(!e)return!0;for(let t in e)return!1;return!0}(i)&&(t={...i,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}_calculateNonstreamingTimeout(e){if(3600*e/128e3>600)throw new nN("Streaming is required for operations that may take longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-typescript#streaming-responses for more details");return 6e5}async prepareOptions(e){}async prepareRequest(e,{url:t,options:s}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,s){return this.request(Promise.resolve(s).then(s=>({method:e,path:t,...s})))}request(e,t=null){return new iy(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,s){let r=await e,n=r.maxRetries??this.maxRetries;null==t&&(t=n),await this.prepareOptions(r);let{req:i,url:a,timeout:o}=await this.buildRequest(r,{retryCount:n-t});await this.prepareRequest(i,{url:a,options:r});let l="log_"+(0x1000000*Math.random()|0).toString(16).padStart(6,"0"),c=void 0===s?"":`, retryOf: ${s}`,h=Date.now();if(il(this).debug(`[${l}] sending request`,ic({retryOfRequestLogID:s,method:r.method,url:a,options:r,headers:i.headers})),r.signal?.aborted)throw new nq;let u=new AbortController,d=await this.fetchWithTimeout(a,i,o,u).catch(nj),p=Date.now();if(d instanceof globalThis.Error){let e=`retrying, ${t} attempts remaining`;if(r.signal?.aborted)throw new nq;let n=nC(d)||/timed? ?out/i.test(String(d)+("cause"in d?String(d.cause):""));if(t)return il(this).info(`[${l}] connection ${n?"timed out":"failed"} - ${e}`),il(this).debug(`[${l}] connection ${n?"timed out":"failed"} (${e})`,ic({retryOfRequestLogID:s,url:a,durationMs:p-h,message:d.message})),this.retryRequest(r,t,s??l);if(il(this).info(`[${l}] connection ${n?"timed out":"failed"} - error; no more retries left`),il(this).debug(`[${l}] connection ${n?"timed out":"failed"} (error; no more retries left)`,ic({retryOfRequestLogID:s,url:a,durationMs:p-h,message:d.message})),n)throw new nD;throw new nW({cause:d})}let f=[...d.headers.entries()].filter(([e])=>"request-id"===e).map(([e,t])=>", "+e+": "+JSON.stringify(t)).join(""),m=`[${l}${c}${f}] ${i.method} ${a} ${d.ok?"succeeded":"failed"} with status ${d.status} in ${p-h}ms`;if(!d.ok){let e=await this.shouldRetry(d);if(t&&e){let e=`retrying, ${t} attempts remaining`;return await n3(d.body),il(this).info(`${m} - ${e}`),il(this).debug(`[${l}] response error (${e})`,ic({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,durationMs:p-h})),this.retryRequest(r,t,s??l,d.headers)}let n=e?"error; no more retries left":"error; not retryable";il(this).info(`${m} - ${n}`);let i=await d.text().catch(e=>nj(e).message),a=nZ(i),o=a?void 0:i;throw il(this).debug(`[${l}] response error (${n})`,ic({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,message:o,durationMs:Date.now()-h})),this.makeStatusError(d.status,a,o,d.headers)}return il(this).info(m),il(this).debug(`[${l}] response start`,ic({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,durationMs:p-h})),{response:d,options:r,controller:u,requestLogID:l,retryOfRequestLogID:s,startTime:h}}getAPIList(e,t,s){return this.requestAPIList(t,{method:"get",path:e,...s})}requestAPIList(e,t){return new i_(this,this.makeRequest(t,null,void 0),e)}async fetchWithTimeout(e,t,s,r){let{signal:n,method:i,...a}=t||{};n&&n.addEventListener("abort",()=>r.abort());let o=setTimeout(()=>r.abort(),s),l=globalThis.ReadableStream&&a.body instanceof globalThis.ReadableStream||"object"==typeof a.body&&null!==a.body&&Symbol.asyncIterator in a.body,c={signal:r.signal,...l?{duplex:"half"}:{},method:"GET",...a};i&&(c.method=i.toUpperCase());try{return await this.fetch.call(void 0,e,c)}finally{clearTimeout(o)}}async shouldRetry(e){let t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||!!(e.status>=500))}async retryRequest(e,t,s,r){let n,i,a=r?.get("retry-after-ms");if(a){let e=parseFloat(a);Number.isNaN(e)||(n=e)}let o=r?.get("retry-after");if(o&&!n){let e=parseFloat(o);n=Number.isNaN(e)?Date.parse(o)-Date.now():1e3*e}if(!(n&&0<=n&&n<6e4)){let s=e.maxRetries??this.maxRetries;n=this.calculateDefaultRetryTimeoutMillis(t,s)}return await (i=n,new Promise(e=>setTimeout(e,i))),this.makeRequest(e,t-1,s)}calculateDefaultRetryTimeoutMillis(e,t){return Math.min(.5*Math.pow(2,t-e),8)*(1-.25*Math.random())*1e3}calculateNonstreamingTimeout(e,t){if(36e5*e/128e3>6e5||null!=t&&e>t)throw new nN("Streaming is required for operations that may take longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-typescript#long-requests for more details");return 6e5}async buildRequest(e,{retryCount:t=0}={}){let s={...e},{method:r,path:n,query:i,defaultBaseURL:a}=s,o=this.buildURL(n,i,a);"timeout"in s&&((e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new nN(`${e} must be an integer`);if(t<0)throw new nN(`${e} must be a positive integer`)})("timeout",s.timeout),s.timeout=s.timeout??this.timeout;let{bodyHeaders:l,body:c}=this.buildBody({options:s}),h=await this.buildHeaders({options:e,method:r,bodyHeaders:l,retryCount:t});return{req:{method:r,headers:h,...s.signal&&{signal:s.signal},...globalThis.ReadableStream&&c instanceof globalThis.ReadableStream&&{duplex:"half"},...c&&{body:c},...this.fetchOptions??{},...s.fetchOptions??{}},url:o,timeout:s.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:s,retryCount:r}){let n={};this.idempotencyHeader&&"get"!==t&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),n[this.idempotencyHeader]=e.idempotencyKey);let a=ij([n,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(r),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...i??(i=(()=>{let e="undefined"!=typeof Deno&&null!=Deno.build?"deno":"undefined"!=typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call(void 0!==globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":n0,"X-Stainless-OS":n2(Deno.build.os),"X-Stainless-Arch":n1(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":n0,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":n0,"X-Stainless-OS":n2(globalThis.process.platform??"unknown"),"X-Stainless-Arch":n1(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let t=function(){if("undefined"==typeof navigator||!navigator)return null;for(let{key:e,pattern:t}of[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let s=t.exec(navigator.userAgent);if(s){let t=s[1]||0,r=s[2]||0,n=s[3]||0;return{browser:e,version:`${t}.${r}.${n}`}}}return null}();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":n0,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":n0,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}})()),...this._options.dangerouslyAllowBrowser?{"anthropic-dangerous-direct-browser-access":"true"}:void 0,"anthropic-version":"2023-06-01"},await this.authHeaders(e),this._options.defaultHeaders,s,e.headers]);return this.validateHeaders(a),a.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let s=ij([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||"string"==typeof e&&s.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:"object"==typeof e&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&"function"==typeof e.next)?{bodyHeaders:void 0,body:n5(e)}:nT(this,tI,"f").call(this,{body:e,headers:s})}}tE=ao,tI=new WeakMap,tO=new WeakSet,tP=function(){return"https://api.anthropic.com"!==this.baseURL},ao.Anthropic=tE,ao.HUMAN_PROMPT="\\n\\nHuman:",ao.AI_PROMPT="\\n\\nAssistant:",ao.DEFAULT_TIMEOUT=6e5,ao.AnthropicError=nN,ao.APIError=nL,ao.APIConnectionError=nW,ao.APIConnectionTimeoutError=nD,ao.APIUserAbortError=nq,ao.NotFoundError=nH,ao.ConflictError=nX,ao.RateLimitError=nK,ao.BadRequestError=nU,ao.AuthenticationError=nB,ao.InternalServerError=nV,ao.PermissionDeniedError=nF,ao.UnprocessableEntityError=nJ,ao.toFile=iP;class al extends ao{constructor(){super(...arguments),this.completions=new i8(this),this.messages=new ar(this),this.models=new ai(this),this.beta=new i3(this)}}al.Completions=i8,al.Messages=ar,al.Models=ai,al.Beta=i3;let ac=new nI({apiKey:process.env.OPENAI_API_KEY}),ah=new al({apiKey:process.env.ANTHROPIC_API_KEY}),au=(0,tG.createClient)("https://bfjstgfcvbxlvvodqoxd.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY);async function ad(e){try{let{query:t}=await e.json();if(!t)return tz.NextResponse.json({error:""},{status:400});let s=(await ac.embeddings.create({model:"text-embedding-3-small",input:t})).data[0].embedding,{data:r,error:n}=await au.from("videos").select("id, video_id, title, script_text, video_url, tags, embedding, duration, thumbnail_url, custom_thumbnail_url").not("embedding","is",null);if(n)throw console.error("Search error:",n),Error("");if(!r||0===r.length)return tz.NextResponse.json({results:[]});let i=r.map(e=>{let t=e.embedding;if("string"==typeof t)try{t=JSON.parse(t)}catch{t=[]}if(!Array.isArray(t)||0===t.length)return{...e,similarity:0};let r=function(e,t){if(e.length!==t.length||0===e.length)return 0;let s=0,r=0,n=0;for(let i=0;i<e.length;i++){let a=Number(e[i])||0,o=Number(t[i])||0;s+=a*o,r+=a*a,n+=o*o}let i=Math.sqrt(r)*Math.sqrt(n);return 0===i?0:s/i}(s,t);return{...e,similarity:isNaN(r)?0:r}}).sort((e,t)=>t.similarity-e.similarity).slice(0,5),a=await ap(t,i);return tz.NextResponse.json({results:a})}catch(e){return console.error("API error:",e),tz.NextResponse.json({error:""},{status:500})}}async function ap(e,t){let s=`: ${e}


JSON:
[{"index": 1, "comment": "", "relevant_excerpt": ""}]

:
${t.map((e,t)=>`${t+1}. : ${e.title}
: ${e.script_text?.substring(0,500)||""}...`).join("\n\n")}`;try{let e=(await ah.messages.create({model:"claude-3-5-haiku-20241022",max_tokens:1024,messages:[{role:"user",content:s}]})).content[0];if("text"!==e.type)throw Error("Unexpected response type");let r=e.text.match(/\[[\s\S]*\]/),n=r?JSON.parse(r[0]):[];return t.map((e,t)=>({video_id:e.video_id,title:e.title,video_url:e.video_url,duration:e.duration,thumbnail_url:e.thumbnail_url,custom_thumbnail_url:e.custom_thumbnail_url,similarity:e.similarity,comment:n[t]?.comment||"",relevant_excerpt:n[t]?.relevant_excerpt||e.script_text?.substring(0,100)||""}))}catch(e){return console.error("Comment generation error:",e),t.map(e=>({video_id:e.video_id,title:e.title,video_url:e.video_url,duration:e.duration,thumbnail_url:e.thumbnail_url,custom_thumbnail_url:e.custom_thumbnail_url,similarity:e.similarity,comment:"",relevant_excerpt:e.script_text?.substring(0,100)||""}))}}e.s(["POST",()=>ad],88065);var af=e.i(88065);let am=new tT.AppRouteRouteModule({definition:{kind:tM.RouteKind.APP_ROUTE,page:"/api/search/route",pathname:"/api/search",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/search/route.ts",nextConfigOutput:"",userland:af}),{workAsyncStorage:ag,workUnitAsyncStorage:ay,serverHooks:aw}=am;function a_(){return(0,tC.patchFetch)({workAsyncStorage:ag,workUnitAsyncStorage:ay})}async function ab(e,t,s){am.isDev&&(0,tj.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let r="/api/search/route";r=r.replace(/\/index$/,"")||"/";let n=await am.prepare(e,t,{srcPage:r,multiZoneDraftMode:!1});if(!n)return t.statusCode=400,t.end("Bad Request"),null==s.waitUntil||s.waitUntil.call(s,Promise.resolve()),null;let{buildId:i,params:a,nextConfig:o,parsedUrl:l,isDraftMode:c,prerenderManifest:h,routerServerContext:u,isOnDemandRevalidate:d,revalidateOnlyGenerated:p,resolvedPathname:f,clientReferenceManifest:m,serverActionsManifest:g}=n,y=(0,tq.normalizeAppPath)(r),w=!!(h.dynamicRoutes[y]||h.routes[f]),_=async()=>((null==u?void 0:u.render404)?await u.render404(e,t,l,!1):t.end("This page could not be found"),null);if(w&&!c){let e=!!h.routes[f],t=h.dynamicRoutes[y];if(t&&!1===t.fallback&&!e){if(o.experimental.adapterPath)return await _();throw new tK.NoFallbackError}}let b=null;!w||am.isDev||c||(b="/index"===(b=f)?"/":b);let v=!0===am.isDev||!w,x=w&&!v;g&&m&&(0,tL.setManifestsSingleton)({page:r,clientReferenceManifest:m,serverActionsManifest:g});let S=e.method||"GET",k=(0,tN.getTracer)(),R=k.getActiveScopeSpan(),$={params:a,prerenderManifest:h,renderOpts:{experimental:{authInterrupts:!!o.experimental.authInterrupts},cacheComponents:!!o.cacheComponents,supportsDynamicResponse:v,incrementalCache:(0,tj.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:o.cacheLife,waitUntil:s.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,s,r,n)=>am.onRequestError(e,t,r,n,u)},sharedContext:{buildId:i}},A=new tW.NodeNextRequest(e),O=new tW.NodeNextResponse(t),E=tD.NextRequestAdapter.fromNodeNextRequest(A,(0,tD.signalFromNodeResponse)(t));try{let n=async e=>am.handle(E,$).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let s=k.getRootSpanAttributes();if(!s)return;if(s.get("next.span_type")!==tU.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${s.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=s.get("next.route");if(n){let t=`${S} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${S} ${r}`)}),i=!!(0,tj.getRequestMeta)(e,"minimalMode"),a=async a=>{var l,f;let m=async({previousCacheEntry:o})=>{try{if(!i&&d&&p&&!o)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let r=await n(a);e.fetchMetrics=$.renderOpts.fetchMetrics;let l=$.renderOpts.pendingWaitUntil;l&&s.waitUntil&&(s.waitUntil(l),l=void 0);let c=$.renderOpts.collectedTags;if(!w)return await (0,tF.sendResponse)(A,O,r,$.renderOpts.pendingWaitUntil),null;{let e=await r.blob(),t=(0,tH.toNodeOutgoingHttpHeaders)(r.headers);c&&(t[tJ.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let s=void 0!==$.renderOpts.collectedRevalidate&&!($.renderOpts.collectedRevalidate>=tJ.INFINITE_CACHE)&&$.renderOpts.collectedRevalidate,n=void 0===$.renderOpts.collectedExpire||$.renderOpts.collectedExpire>=tJ.INFINITE_CACHE?void 0:$.renderOpts.collectedExpire;return{value:{kind:tV.CachedRouteKind.APP_ROUTE,status:r.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:s,expire:n}}}}catch(t){throw(null==o?void 0:o.isStale)&&await am.onRequestError(e,t,{routerKind:"App Router",routePath:r,routeType:"route",revalidateReason:(0,tB.getRevalidateReason)({isStaticGeneration:x,isOnDemandRevalidate:d})},!1,u),t}},g=await am.handleResponse({req:e,nextConfig:o,cacheKey:b,routeKind:tM.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:h,isRoutePPREnabled:!1,isOnDemandRevalidate:d,revalidateOnlyGenerated:p,responseGenerator:m,waitUntil:s.waitUntil,isMinimalMode:i});if(!w)return null;if((null==g||null==(l=g.value)?void 0:l.kind)!==tV.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==g||null==(f=g.value)?void 0:f.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",d?"REVALIDATED":g.isMiss?"MISS":g.isStale?"STALE":"HIT"),c&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let y=(0,tH.fromNodeOutgoingHttpHeaders)(g.value.headers);return i&&w||y.delete(tJ.NEXT_CACHE_TAGS_HEADER),!g.cacheControl||t.getHeader("Cache-Control")||y.get("Cache-Control")||y.set("Cache-Control",(0,tX.getCacheControlHeader)(g.cacheControl)),await (0,tF.sendResponse)(A,O,new Response(g.value.body,{headers:y,status:g.value.status||200})),null};R?await a(R):await k.withPropagatedContext(e.headers,()=>k.trace(tU.BaseServerSpan.handleRequest,{spanName:`${S} ${r}`,kind:tN.SpanKind.SERVER,attributes:{"http.method":S,"http.target":e.url}},a))}catch(t){if(t instanceof tK.NoFallbackError||await am.onRequestError(e,t,{routerKind:"App Router",routePath:y,routeType:"route",revalidateReason:(0,tB.getRevalidateReason)({isStaticGeneration:x,isOnDemandRevalidate:d})},!1,u),w)throw t;return await (0,tF.sendResponse)(A,O,new Response(null,{status:500})),null}}e.s(["handler",()=>ab,"patchFetch",()=>a_,"routeModule",()=>am,"serverHooks",()=>aw,"workAsyncStorage",()=>ag,"workUnitAsyncStorage",()=>ay],51604)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_44d9a245.js.map