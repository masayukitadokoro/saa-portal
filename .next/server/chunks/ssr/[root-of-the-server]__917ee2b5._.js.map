{"version":3,"sources":["../../../../node_modules/next/src/server/route-modules/app-page/vendored/contexts/hooks-client-context.ts","../../../../node_modules/next/src/server/route-modules/app-page/vendored/contexts/server-inserted-html.ts","../../../../lib/supabase-client.ts","../../../../lib/tracking.ts","../../../../app/auth/login/page.tsx"],"sourcesContent":["module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['contexts'].HooksClientContext\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['contexts'].ServerInsertedHtml\n","import { createBrowserClient } from '@supabase/ssr';\n\nexport function createClient() {\n  return createBrowserClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\n  );\n}\n","// アクティビティタイプの定義\nexport type ActivityType = \n  | 'login'\n  | 'video_view'\n  | 'video_complete'\n  | 'article_view'\n  | 'resource_download'\n  | 'bookmark_add'\n  | 'bookmark_remove'\n  | 'search';\n\ninterface TrackActivityParams {\n  activity_type: ActivityType;\n  target_id?: string;\n  target_title?: string;\n  metadata?: Record<string, any>;\n}\n\n// アクティビティを記録する関数\nexport async function trackActivity(params: TrackActivityParams): Promise<void> {\n  try {\n    await fetch('/api/activities', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify(params),\n    });\n  } catch (error) {\n    // トラッキングエラーは無視（ユーザー体験に影響させない）\n    console.error('Tracking error:', error);\n  }\n}\n\n// 便利なヘルパー関数\nexport const track = {\n  login: () => trackActivity({ activity_type: 'login' }),\n  \n  videoView: (videoId: string, title: string) => \n    trackActivity({ \n      activity_type: 'video_view', \n      target_id: videoId, \n      target_title: title \n    }),\n  \n  videoComplete: (videoId: string, title: string, watchTime?: number) => \n    trackActivity({ \n      activity_type: 'video_complete', \n      target_id: videoId, \n      target_title: title,\n      metadata: watchTime ? { watch_time: watchTime } : {}\n    }),\n  \n  articleView: (articleId: string, title: string) => \n    trackActivity({ \n      activity_type: 'article_view', \n      target_id: articleId, \n      target_title: title \n    }),\n  \n  resourceDownload: (resourceId: string, title: string, type?: string) => \n    trackActivity({ \n      activity_type: 'resource_download', \n      target_id: resourceId, \n      target_title: title,\n      metadata: type ? { resource_type: type } : {}\n    }),\n  \n  bookmarkAdd: (videoId: string, title: string) => \n    trackActivity({ \n      activity_type: 'bookmark_add', \n      target_id: videoId, \n      target_title: title \n    }),\n  \n  bookmarkRemove: (videoId: string, title: string) => \n    trackActivity({ \n      activity_type: 'bookmark_remove', \n      target_id: videoId, \n      target_title: title \n    }),\n  \n  search: (query: string, resultCount?: number) => \n    trackActivity({ \n      activity_type: 'search', \n      metadata: { query, result_count: resultCount }\n    }),\n};\n","'use client';\n\nimport { useState } from 'react';\nimport { track } from '@/lib/tracking';\nimport { useRouter } from 'next/navigation';\nimport Link from 'next/link';\nimport { createClient } from '@/lib/supabase-client';\n\nexport default function LoginPage() {\n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  const [totpCode, setTotpCode] = useState('');\n  const [error, setError] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const [needsMFA, setNeedsMFA] = useState(false);\n  const [factorId, setFactorId] = useState('');\n  const router = useRouter();\n  const supabase = createClient();\n\n  const handleLogin = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError('');\n    setIsLoading(true);\n\n    try {\n      const { data, error } = await supabase.auth.signInWithPassword({\n        email,\n        password,\n      });\n\n      if (error) {\n        setError(error.message);\n        setIsLoading(false);\n        return;\n      }\n\n      // MFAが必要かチェック\n      if (data.session) {\n        const { data: factorsData } = await supabase.auth.mfa.listFactors();\n        \n        if (factorsData?.totp && factorsData.totp.length > 0) {\n          // MFA認証が必要\n          const factor = factorsData.totp[0];\n          setFactorId(factor.id);\n          setNeedsMFA(true);\n          setIsLoading(false);\n          return;\n        }\n      }\n\n      // MFA不要の場合はホームへ\n      track.login();\n      router.push('/');\n      router.refresh();\n    } catch (err) {\n      setError('ログインに失敗しました');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleMFAVerify = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError('');\n    setIsLoading(true);\n\n    try {\n      const { data: challengeData, error: challengeError } = \n        await supabase.auth.mfa.challenge({ factorId });\n\n      if (challengeError) {\n        setError(challengeError.message);\n        setIsLoading(false);\n        return;\n      }\n\n      const { error: verifyError } = await supabase.auth.mfa.verify({\n        factorId,\n        challengeId: challengeData.id,\n        code: totpCode,\n      });\n\n      if (verifyError) {\n        setError('認証コードが正しくありません');\n        setIsLoading(false);\n        return;\n      }\n\n      track.login();\n      router.push('/');\n      router.refresh();\n    } catch (err) {\n      setError('2段階認証に失敗しました');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  // 2段階認証フォーム\n  if (needsMFA) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n        <div className=\"max-w-md w-full bg-white rounded-lg shadow p-8\">\n          <h2 className=\"text-2xl font-bold text-center text-gray-800 mb-4\">\n            2段階認証\n          </h2>\n          <p className=\"text-center text-gray-600 mb-8\">\n            認証アプリに表示されている6桁のコードを入力してください\n          </p>\n\n          <form onSubmit={handleMFAVerify} className=\"space-y-6\">\n            {error && (\n              <div className=\"p-3 bg-red-50 border border-red-200 rounded text-red-600 text-sm\">\n                {error}\n              </div>\n            )}\n\n            <div>\n              <input\n                type=\"text\"\n                value={totpCode}\n                onChange={(e) => setTotpCode(e.target.value.replace(/\\D/g, '').slice(0, 6))}\n                required\n                maxLength={6}\n                className=\"w-full px-4 py-4 text-center text-2xl tracking-widest \n                         border border-gray-300 rounded-lg \n                         focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                placeholder=\"000000\"\n                autoFocus\n              />\n            </div>\n\n            <button\n              type=\"submit\"\n              disabled={isLoading || totpCode.length !== 6}\n              className=\"w-full py-3 bg-blue-600 text-white rounded-lg \n                       hover:bg-blue-700 disabled:bg-gray-400 \n                       transition-colors font-medium\"\n            >\n              {isLoading ? '確認中...' : '確認'}\n            </button>\n          </form>\n        </div>\n      </div>\n    );\n  }\n\n  // 通常ログインフォーム\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n      <div className=\"max-w-md w-full bg-white rounded-lg shadow p-8\">\n        <h2 className=\"text-2xl font-bold text-center text-gray-800 mb-8\">\n          ログイン\n        </h2>\n\n        <form onSubmit={handleLogin} className=\"space-y-6\">\n          {error && (\n            <div className=\"p-3 bg-red-50 border border-red-200 rounded text-red-600 text-sm\">\n              {error}\n            </div>\n          )}\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              メールアドレス\n            </label>\n            <input\n              type=\"email\"\n              value={email}\n              onChange={(e) => setEmail(e.target.value)}\n              required\n              className=\"w-full px-4 py-3 border border-gray-300 rounded-lg \n                       focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n              placeholder=\"example@email.com\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              パスワード\n            </label>\n            <input\n              type=\"password\"\n              value={password}\n              onChange={(e) => setPassword(e.target.value)}\n              required\n              className=\"w-full px-4 py-3 border border-gray-300 rounded-lg \n                       focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n              placeholder=\"••••••••\"\n            />\n          </div>\n\n          <button\n            type=\"submit\"\n            disabled={isLoading}\n            className=\"w-full py-3 bg-blue-600 text-white rounded-lg \n                     hover:bg-blue-700 disabled:bg-gray-400 \n                     transition-colors font-medium\"\n          >\n            {isLoading ? 'ログイン中...' : 'ログイン'}\n          </button>\n        </form>\n\n        <p className=\"mt-6 text-center text-sm text-gray-600\">\n          アカウントをお持ちでないですか？{' '}\n          <Link href=\"/auth/signup\" className=\"text-blue-600 hover:underline\">\n            サインアップ\n          </Link>\n        </p>\n      </div>\n    </div>\n  );\n}\n"],"names":["module","exports","require","vendored","HooksClientContext","ServerInsertedHtml"],"mappings":"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","ignoreList":[0,1]}