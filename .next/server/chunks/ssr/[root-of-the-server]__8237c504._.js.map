{"version":3,"sources":["../../../../node_modules/next/src/server/route-modules/app-page/vendored/contexts/hooks-client-context.ts","../../../../node_modules/next/src/server/route-modules/app-page/vendored/contexts/server-inserted-html.ts","../../../../lib/supabase-client.ts","../../../../components/AuthProvider.tsx","../../../../app/auth/setup-2fa/page.tsx"],"sourcesContent":["module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['contexts'].HooksClientContext\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['contexts'].ServerInsertedHtml\n","import { createBrowserClient } from '@supabase/ssr';\n\nexport function createClient() {\n  return createBrowserClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\n  );\n}\n","'use client';\n\nimport { createContext, useContext, useEffect, useState } from 'react';\nimport { User, Session } from '@supabase/supabase-js';\nimport { createClient } from '@/lib/supabase-client';\n\ninterface AuthContextType {\n  user: User | null;\n  session: Session | null;\n  isLoading: boolean;\n  signOut: () => Promise<void>;\n}\n\nconst AuthContext = createContext<AuthContextType>({\n  user: null,\n  session: null,\n  isLoading: true,\n  signOut: async () => {},\n});\n\nexport function AuthProvider({ children }: { children: React.ReactNode }) {\n  const [user, setUser] = useState<User | null>(null);\n  const [session, setSession] = useState<Session | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const supabase = createClient();\n\n  useEffect(() => {\n    // ÂàùÊúü„Çª„ÉÉ„Ç∑„Éß„É≥ÂèñÂæó\n    supabase.auth.getSession().then(({ data: { session } }) => {\n      setSession(session);\n      setUser(session?.user ?? null);\n      setIsLoading(false);\n    });\n\n    // Ë™çË®ºÁä∂ÊÖã„ÅÆÂ§âÂåñ„ÇíÁõ£Ë¶ñ\n    const {\n      data: { subscription },\n    } = supabase.auth.onAuthStateChange((_event, session) => {\n      setSession(session);\n      setUser(session?.user ?? null);\n      setIsLoading(false);\n    });\n\n    return () => subscription.unsubscribe();\n  }, []);\n\n  const signOut = async () => {\n    await supabase.auth.signOut();\n  };\n\n  return (\n    <AuthContext.Provider value={{ user, session, isLoading, signOut }}>\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport const useAuth = () => useContext(AuthContext);\n","'use client';\n\nimport { useState, useEffect } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { createClient } from '@/lib/supabase-client';\nimport { useAuth } from '@/components/AuthProvider';\n\nexport default function Setup2FAPage() {\n  const [qrCode, setQrCode] = useState('');\n  const [secret, setSecret] = useState('');\n  const [verifyCode, setVerifyCode] = useState('');\n  const [error, setError] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const [isEnabled, setIsEnabled] = useState(false);\n  const [factorId, setFactorId] = useState('');\n  const router = useRouter();\n  const { user } = useAuth();\n  const supabase = createClient();\n\n  useEffect(() => {\n    checkMFAStatus();\n  }, []);\n\n  const checkMFAStatus = async () => {\n    const { data } = await supabase.auth.mfa.listFactors();\n    if (data?.totp && data.totp.length > 0) {\n      setIsEnabled(true);\n      setFactorId(data.totp[0].id);\n    }\n  };\n\n  const startEnroll = async () => {\n    setIsLoading(true);\n    setError('');\n\n    try {\n      const { data, error } = await supabase.auth.mfa.enroll({\n        factorType: 'totp',\n        friendlyName: 'ÂãïÁîªÊ§úÁ¥¢„Ç¢„Éó„É™',\n      });\n\n      if (error) {\n        setError(error.message);\n        return;\n      }\n\n      if (data) {\n        setQrCode(data.totp.qr_code);\n        setSecret(data.totp.secret);\n        setFactorId(data.id);\n      }\n    } catch (err) {\n      setError('2FAË®≠ÂÆö„ÅÆÈñãÂßã„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const verifyAndEnable = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsLoading(true);\n    setError('');\n\n    try {\n      const { data: challengeData, error: challengeError } = \n        await supabase.auth.mfa.challenge({ factorId });\n\n      if (challengeError) {\n        setError(challengeError.message);\n        return;\n      }\n\n      const { error: verifyError } = await supabase.auth.mfa.verify({\n        factorId,\n        challengeId: challengeData.id,\n        code: verifyCode,\n      });\n\n      if (verifyError) {\n        setError('Ë™çË®º„Ç≥„Éº„Éâ„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„Çì');\n        return;\n      }\n\n      setIsEnabled(true);\n      setQrCode('');\n      setSecret('');\n    } catch (err) {\n      setError('2FA„ÅÆÊúâÂäπÂåñ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const disable2FA = async () => {\n    if (!confirm('2ÊÆµÈöéË™çË®º„ÇíÁÑ°Âäπ„Å´„Åó„Åæ„Åô„ÅãÔºü')) return;\n\n    setIsLoading(true);\n    try {\n      const { error } = await supabase.auth.mfa.unenroll({ factorId });\n      if (error) {\n        setError(error.message);\n      } else {\n        setIsEnabled(false);\n        setFactorId('');\n      }\n    } catch (err) {\n      setError('2FA„ÅÆÁÑ°ÂäπÂåñ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  if (!user) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <p>„É≠„Ç∞„Ç§„É≥„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 py-12\">\n      <div className=\"max-w-md mx-auto bg-white rounded-lg shadow p-8\">\n        <h2 className=\"text-2xl font-bold text-center text-gray-800 mb-8\">\n          2ÊÆµÈöéË™çË®ºË®≠ÂÆö\n        </h2>\n\n        {error && (\n          <div className=\"mb-6 p-3 bg-red-50 border border-red-200 rounded text-red-600 text-sm\">\n            {error}\n          </div>\n        )}\n\n        {isEnabled ? (\n          // 2FAÊúâÂäπÊôÇ\n          <div className=\"text-center\">\n            <div className=\"text-5xl mb-4\">üîí</div>\n            <p className=\"text-green-600 font-medium mb-6\">\n              2ÊÆµÈöéË™çË®º„ÅåÊúâÂäπ„Åß„Åô\n            </p>\n            <button\n              onClick={disable2FA}\n              disabled={isLoading}\n              className=\"px-6 py-2 text-red-600 border border-red-300 rounded-lg \n                       hover:bg-red-50 disabled:opacity-50\"\n            >\n              {isLoading ? 'Âá¶ÁêÜ‰∏≠...' : '2FA„ÇíÁÑ°Âäπ„Å´„Åô„Çã'}\n            </button>\n          </div>\n        ) : qrCode ? (\n          // QR„Ç≥„Éº„ÉâË°®Á§∫„ÉªÁ¢∫Ë™ç\n          <div>\n            <p className=\"text-gray-600 mb-4 text-center\">\n              Ë™çË®º„Ç¢„Éó„É™ÔºàGoogle AuthenticatorÁ≠âÔºâ„ÅßQR„Ç≥„Éº„Éâ„Çí„Çπ„Ç≠„É£„É≥„Åó„Å¶„Åè„Å†„Åï„ÅÑ\n            </p>\n            \n            <div className=\"flex justify-center mb-6\">\n              <img src={qrCode} alt=\"2FA QR Code\" className=\"w-48 h-48\" />\n            </div>\n\n            <div className=\"mb-6 p-3 bg-gray-100 rounded text-center\">\n              <p className=\"text-xs text-gray-500 mb-1\">ÊâãÂãïÂÖ•ÂäõÁî®„Ç∑„Éº„ÇØ„É¨„ÉÉ„Éà</p>\n              <code className=\"text-sm break-all\">{secret}</code>\n            </div>\n\n            <form onSubmit={verifyAndEnable} className=\"space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Ë™çË®º„Ç¢„Éó„É™„Å´Ë°®Á§∫„Åï„Çå„Åü6Ê°Å„ÅÆ„Ç≥„Éº„Éâ\n                </label>\n                <input\n                  type=\"text\"\n                  value={verifyCode}\n                  onChange={(e) => setVerifyCode(e.target.value.replace(/\\D/g, '').slice(0, 6))}\n                  required\n                  maxLength={6}\n                  className=\"w-full px-4 py-3 text-center text-xl tracking-widest \n                           border border-gray-300 rounded-lg \n                           focus:ring-2 focus:ring-blue-500\"\n                  placeholder=\"000000\"\n                />\n              </div>\n\n              <button\n                type=\"submit\"\n                disabled={isLoading || verifyCode.length !== 6}\n                className=\"w-full py-3 bg-blue-600 text-white rounded-lg \n                         hover:bg-blue-700 disabled:bg-gray-400\"\n              >\n                {isLoading ? 'Á¢∫Ë™ç‰∏≠...' : '2FA„ÇíÊúâÂäπ„Å´„Åô„Çã'}\n              </button>\n            </form>\n          </div>\n        ) : (\n          // ÂàùÊúüÁä∂ÊÖã\n          <div className=\"text-center\">\n            <div className=\"text-5xl mb-4\">üîê</div>\n            <p className=\"text-gray-600 mb-6\">\n              2ÊÆµÈöéË™çË®º„ÇíË®≠ÂÆö„Åô„Çã„Å®„ÄÅ„É≠„Ç∞„Ç§„É≥ÊôÇ„Å´Ë™çË®º„Ç¢„Éó„É™„ÅÆ„Ç≥„Éº„Éâ„ÅåÂøÖË¶Å„Å´„Å™„Çä„ÄÅ\n              „Çª„Ç≠„É•„É™„ÉÜ„Ç£„ÅåÂêë‰∏ä„Åó„Åæ„Åô„ÄÇ\n            </p>\n            <button\n              onClick={startEnroll}\n              disabled={isLoading}\n              className=\"px-6 py-3 bg-blue-600 text-white rounded-lg \n                       hover:bg-blue-700 disabled:bg-gray-400\"\n            >\n              {isLoading ? 'Ê∫ñÂÇô‰∏≠...' : '2FA„ÇíË®≠ÂÆö„Åô„Çã'}\n            </button>\n          </div>\n        )}\n\n        <div className=\"mt-8 text-center\">\n          <button\n            onClick={() => router.push('/')}\n            className=\"text-gray-500 hover:text-gray-700\"\n          >\n            ‚Üê „Éõ„Éº„É†„Å´Êàª„Çã\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":["module","exports","require","vendored","HooksClientContext","ServerInsertedHtml"],"mappings":"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","ignoreList":[0,1]}